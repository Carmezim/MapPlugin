{"version":3,"file":"bundle.js","sources":["../src/maps.js"],"sourcesContent":["import * as options from 'options';\n\nclusterOptions = options.clusterOptions;\nmapOptions = options.mapOptions;\nicon = options.icon;\n\n// Map\nlet map;\n\n// Search Box input\nlet input;\n\n// Search Box\nlet sBox;\n\n// Map center\nconst london = new google.maps.LatLng(51.521723, -0.134581);\n\n// Places markers\nlet placeMarkers = [];\n\n// Clusterer markers\nconst markers = [];\n\n\nfunction createMap() {\n  map = new google.maps.Map(document.getElementById(\"map\"), mapOptions);\n}\n\nfunction createSearchBox() {\n  // Create search box and link it to UI\n  input = document.getElementById('pac-input');\n  sBox = new google.maps.places.SearchBox(input);\n  map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);\n}\n\nfunction searchBox() {\n\n  // Places Search Box\n  createSearchBox();\n\n  // Bias searchbox results towards current map's viewport\n  map.addListener('bounds_changed', function() {\n    sBox.setBounds(map.getBounds());\n  });\n\n  // Listen for the event fired when the user selects a prediction and retrieve\n  // more details for that place.\n  sBox.addListener('places_changed', function() {\n    let places = sBox.getPlaces();\n\n    if (places.length == 0) {\n      return;\n    }\n\n    // Clear out the old markers.\n    placeMarkers.forEach(function(marker) {\n      marker.setMap(null);\n    });\n    placeMarkers = [];\n\n    // For each place, get the icon, name and location.\n    const bounds = new google.maps.LatLngBounds();\n    places.forEach(function(place) {\n      if (!place.geometry) {\n        console.log(\"Returned place contains no geometry\");\n        return;\n      }\n\n      let placeIcon = {\n        url: place.icon,\n        size: icon.size,\n        origin: icon.origin,\n        anchor: icon.anchor,\n        scaledSize: icon.scaledSize\n      };\n\n      options.setIcon(placeIcon);\n\n      placeMarkers.push(new google.maps.Marker({\n        map: map,\n        icon: icon,\n        title: place.name,\n        position: place.geometry.location\n      }));\n\n      if (place.geometry.viewport) {\n        // Only geocodes have viewport.\n        bounds.union(place.geometry.viewport);\n      } else {\n        bounds.extend(place.geometry.location);\n      }\n    });\n    map.fitBounds(bounds);\n  });\n}\n//\n// export function setGoogleMaps(){\n// \taddEventListener('DOMContentLoaded', function () {\n//   \tif (document.querySelectorAll('#map').length > 0) {\n//     \tconst script      = document.createElement('script');\n//       \t    script.type = 'text/javascript';\n//         \t  script.src  = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyCR527NNTzbSOMy4D6ZFDLtEfsGl7Z3Q2I&libraries=places&callback=initialize';\n//\n//     document.body.appendChild(script);\n//   \t}\n// \t})\n// }\n\n\nfunction isJSON(dataset) {\n  try {\n    JSON.stringify(dataset);\n    return true;\n  }\n  catch(err) {\n    console.error('Data is not JSON format!');\n    return false;\n  }\n}\n\nexport function getData(data) {\n\n  data = typeof data !== 'string' ? 'datasets/' + data.toString() : 'datasets/' + data;\n\n  if(isJSON(data)) {\n    fetch(data)\n      .then((response) => response.json())\n      .then(function (dataset) {\n        // not to confuse 'map' as in array.proptype.map below with an instance of a google map\n        // add locations\n        dataset.map((markerPosition) => {\n          if (!markerPosition.latitude || !markerPosition.longitude) {\n            console.log('meh');\n          }\n          else {\n            let location = new google.maps.LatLng({lat: markerPosition.latitude, lng: markerPosition.longitude});\n\n            const marker = new google.maps.Marker({\n              position: location,\n              map: map,\n              icon: icon\n            });\n            markers.push(marker);\n          }\n        });\n        // create MarkerClusterer\n        const markerCluster = new MarkerClusterer(map, markers, clusterOptions);\n      })\n      .catch((err) => {\n        if (err) throw err\n    });\n  }\n}\n\nexport function initialize(data) {\n\n  const t0 = performance.now();\n\n  //Create Map\n  createMap();\n\n  // Fetch data\n  getData(data);\n  \n  // Create Search Box\n  searchBox();\n\n  const t1 = performance.now();\n  console.log(\"Call to initialize took \" + (t1 - t0) + \" milliseconds.\");\n\n}\n"],"names":["clusterOptions","options","mapOptions","icon","map","input","sBox","london","google","maps","LatLng","placeMarkers","markers","createMap","Map","document","getElementById","createSearchBox","places","SearchBox","controls","ControlPosition","TOP_LEFT","push","searchBox","addListener","setBounds","getBounds","getPlaces","length","forEach","marker","setMap","bounds","LatLngBounds","place","geometry","log","placeIcon","size","origin","anchor","scaledSize","Marker","name","location","viewport","union","extend","fitBounds","isJSON","dataset","stringify","err","error","getData","data","toString","then","response","json","markerPosition","latitude","longitude","lat","lng","markerCluster","MarkerClusterer","catch","initialize","t0","performance","now","t1"],"mappings":"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"}