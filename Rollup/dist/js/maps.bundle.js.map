{"version":3,"file":"maps.bundle.js","sources":["../../src/components/map/markerclusterer.js","../../src/components/searchBox/createSearchBox.js","../../src/components/map/svgMarkers.js","../../src/components/map/mapStyles.js","../../src/components/map/defineCenter.js","../../src/components/map/options.js","../../src/components/searchBox/searchBox.js","../../src/components/promoArea/promoAreaLogged.js","../../src/components/promoArea/promoArea.js","../../node_modules/clusterize.js/clusterize.js","../../src/components/buildList/buildList.js","../../src/components/fetchData/checkData.js","../../src/components/fetchData/getRandom.js","../../src/components/characters/iconsList.js","../../src/components/fetchData/fetchData.js","../../src/components/map/createMap.js","../../node_modules/promise-polyfill/promise.js","../../src/polyfills/promise.js","../../node_modules/whatwg-fetch/fetch.js","../../src/components/characters/placeCharacters.js","../../src/components/characters/checkAssetsPath.js","../../src/components/map/map.js"],"sourcesContent":["// ==ClosureCompiler==\r\n// @compilation_level ADVANCED_OPTIMIZATIONS\r\n// @externs_url http://closure-compiler.googlecode.com/svn/trunk/contrib/externs/maps/google_maps_api_v3_3.js\r\n// ==/ClosureCompiler==\r\n\r\n/**\r\n * @name MarkerClusterer for Google Maps v3\r\n * @version version 1.0.1\r\n * @author Luke Mahe\r\n * @fileoverview\r\n * The library creates and manages per-zoom-level clusters for large amounts of\r\n * markers.\r\n * <br/>\r\n * This is a v3 implementation of the\r\n * <a href=\"http://gmaps-utility-library-dev.googlecode.com/svn/tags/markerclusterer/\"\r\n * >v2 MarkerClusterer</a>.\r\n */\r\n\r\n/**\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n\r\n/**\r\n * A Marker Clusterer that clusters markers.\r\n *\r\n * @param {google.maps.Map} map The Google map to attach to.\r\n * @param {Array.<google.maps.Marker>=} opt_markers Optional markers to add to\r\n *   the cluster.\r\n * @param {Object=} opt_options support the following options:\r\n *     'gridSize': (number) The grid size of a cluster in pixels.\r\n *     'maxZoom': (number) The maximum zoom level that a marker can be part of a\r\n *                cluster.\r\n *     'zoomOnClick': (boolean) Whether the default behaviour of clicking on a\r\n *                    cluster is to zoom into it.\r\n *     'imagePath': (string) The base URL where the images representing\r\n *                  clusters will be found. The full URL will be:\r\n *                  {imagePath}[1-5].{imageExtension}\r\n *                  Default: '../images/m'.\r\n *     'imageExtension': (string) The suffix for images URL representing\r\n *                       clusters will be found. See _imagePath_ for details.\r\n *                       Default: 'png'.\r\n *     'averageCenter': (boolean) Whether the center of each cluster should be\r\n *                      the average of all markers in the cluster.\r\n *     'minimumClusterSize': (number) The minimum number of markers to be in a\r\n *                           cluster before the markers are hidden and a count\r\n *                           is shown.\r\n *     'styles': (object) An object that has style properties:\r\n *       'url': (string) The image url.\r\n *       'height': (number) The image height.\r\n *       'width': (number) The image width.\r\n *       'anchor': (Array) The anchor position of the label text.\r\n *       'textColor': (string) The text color.\r\n *       'textSize': (number) The text size.\r\n *       'backgroundPosition': (string) The position of the backgound x, y.\r\n * @constructor\r\n * @extends google.maps.OverlayView\r\n */\r\nfunction MarkerClusterer(map, opt_markers, opt_options) {\r\n  // MarkerClusterer implements google.maps.OverlayView interface. We use the\r\n  // extend function to extend MarkerClusterer with google.maps.OverlayView\r\n  // because it might not always be available when the code is defined so we\r\n  // look for it at the last possible moment. If it doesn't exist now then\r\n  // there is no point going ahead :)\r\n  this.extend(MarkerClusterer, google.maps.OverlayView);\r\n  this.map_ = map;\r\n\r\n  /**\r\n   * @type {Array.<google.maps.Marker>}\r\n   * @private\r\n   */\r\n  this.markers_ = [];\r\n\r\n  /**\r\n   *  @type {Array.<Cluster>}\r\n   */\r\n  this.clusters_ = [];\r\n\r\n  this.sizes = [53, 56, 66, 78, 90];\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.styles_ = [];\r\n\r\n  /**\r\n   * @type {boolean}\r\n   * @private\r\n   */\r\n  this.ready_ = false;\r\n\r\n  var options = opt_options || {};\r\n\r\n  /**\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  this.gridSize_ = options['gridSize'] || 60;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.minClusterSize_ = options['minimumClusterSize'] || 2;\r\n\r\n\r\n  /**\r\n   * @type {?number}\r\n   * @private\r\n   */\r\n  this.maxZoom_ = options['maxZoom'] || null;\r\n\r\n  this.styles_ = options['styles'] || [];\r\n\r\n  /**\r\n   * @type {string}\r\n   * @private\r\n   */\r\n  this.imagePath_ = options['imagePath'] ||\r\n      this.MARKER_CLUSTER_IMAGE_PATH_;\r\n\r\n  /**\r\n   * @type {string}\r\n   * @private\r\n   */\r\n  this.imageExtension_ = options['imageExtension'] ||\r\n      this.MARKER_CLUSTER_IMAGE_EXTENSION_;\r\n\r\n  /**\r\n   * @type {boolean}\r\n   * @private\r\n   */\r\n  this.zoomOnClick_ = true;\r\n\r\n  if (options['zoomOnClick'] != undefined) {\r\n    this.zoomOnClick_ = options['zoomOnClick'];\r\n  }\r\n\r\n  /**\r\n   * @type {boolean}\r\n   * @private\r\n   */\r\n  this.averageCenter_ = false;\r\n\r\n  if (options['averageCenter'] != undefined) {\r\n    this.averageCenter_ = options['averageCenter'];\r\n  }\r\n\r\n  this.setupStyles_();\r\n\r\n  this.setMap(map);\r\n\r\n  /**\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  this.prevZoom_ = this.map_.getZoom();\r\n\r\n  // Add the map event listeners\r\n  var that = this;\r\n  google.maps.event.addListener(this.map_, 'zoom_changed', function() {\r\n    // Determines map type and prevent illegal zoom levels\r\n    var zoom = that.map_.getZoom();\r\n    var minZoom = that.map_.minZoom || 0;\r\n    var maxZoom = Math.min(that.map_.maxZoom || 100,\r\n                         that.map_.mapTypes[that.map_.getMapTypeId()].maxZoom);\r\n    zoom = Math.min(Math.max(zoom,minZoom),maxZoom);\r\n\r\n    if (that.prevZoom_ != zoom) {\r\n      that.prevZoom_ = zoom;\r\n      that.resetViewport();\r\n    }\r\n  });\r\n\r\n  google.maps.event.addListener(this.map_, 'idle', function() {\r\n    that.redraw();\r\n  });\r\n\r\n  // Finally, add the markers\r\n  if (opt_markers && (opt_markers.length || Object.keys(opt_markers).length)) {\r\n    this.addMarkers(opt_markers, false);\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * The marker cluster image path.\r\n *\r\n * @type {string}\r\n * @private\r\n */\r\nMarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_PATH_ = '../images/m';\r\n\r\n\r\n/**\r\n * The marker cluster image path.\r\n *\r\n * @type {string}\r\n * @private\r\n */\r\nMarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_EXTENSION_ = 'png';\r\n\r\n\r\n/**\r\n * Extends a objects prototype by anothers.\r\n *\r\n * @param {Object} obj1 The object to be extended.\r\n * @param {Object} obj2 The object to extend with.\r\n * @return {Object} The new extended object.\r\n * @ignore\r\n */\r\nMarkerClusterer.prototype.extend = function(obj1, obj2) {\r\n  return (function(object) {\r\n    for (var property in object.prototype) {\r\n      this.prototype[property] = object.prototype[property];\r\n    }\r\n    return this;\r\n  }).apply(obj1, [obj2]);\r\n};\r\n\r\n\r\n/**\r\n * Implementaion of the interface method.\r\n * @ignore\r\n */\r\nMarkerClusterer.prototype.onAdd = function() {\r\n  this.setReady_(true);\r\n};\r\n\r\n/**\r\n * Implementaion of the interface method.\r\n * @ignore\r\n */\r\nMarkerClusterer.prototype.draw = function() {};\r\n\r\n/**\r\n * Sets up the styles object.\r\n *\r\n * @private\r\n */\r\nMarkerClusterer.prototype.setupStyles_ = function() {\r\n  if (this.styles_.length) {\r\n    return;\r\n  }\r\n\r\n  for (var i = 0, size; size = this.sizes[i]; i++) {\r\n    this.styles_.push({\r\n      url: this.imagePath_ + (i + 1) + '.' + this.imageExtension_,\r\n      height: size,\r\n      width: size\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n *  Fit the map to the bounds of the markers in the clusterer.\r\n */\r\nMarkerClusterer.prototype.fitMapToMarkers = function() {\r\n  var markers = this.getMarkers();\r\n  var bounds = new google.maps.LatLngBounds();\r\n  for (var i = 0, marker; marker = markers[i]; i++) {\r\n    bounds.extend(marker.getPosition());\r\n  }\r\n\r\n  this.map_.fitBounds(bounds);\r\n};\r\n\r\n\r\n/**\r\n *  Sets the styles.\r\n *\r\n *  @param {Object} styles The style to set.\r\n */\r\nMarkerClusterer.prototype.setStyles = function(styles) {\r\n  this.styles_ = styles;\r\n};\r\n\r\n\r\n/**\r\n *  Gets the styles.\r\n *\r\n *  @return {Object} The styles object.\r\n */\r\nMarkerClusterer.prototype.getStyles = function() {\r\n  return this.styles_;\r\n};\r\n\r\n\r\n/**\r\n * Whether zoom on click is set.\r\n *\r\n * @return {boolean} True if zoomOnClick_ is set.\r\n */\r\nMarkerClusterer.prototype.isZoomOnClick = function() {\r\n  return this.zoomOnClick_;\r\n};\r\n\r\n/**\r\n * Whether average center is set.\r\n *\r\n * @return {boolean} True if averageCenter_ is set.\r\n */\r\nMarkerClusterer.prototype.isAverageCenter = function() {\r\n  return this.averageCenter_;\r\n};\r\n\r\n\r\n/**\r\n *  Returns the array of markers in the clusterer.\r\n *\r\n *  @return {Array.<google.maps.Marker>} The markers.\r\n */\r\nMarkerClusterer.prototype.getMarkers = function() {\r\n  return this.markers_;\r\n};\r\n\r\n\r\n/**\r\n *  Returns the number of markers in the clusterer\r\n *\r\n *  @return {Number} The number of markers.\r\n */\r\nMarkerClusterer.prototype.getTotalMarkers = function() {\r\n  return this.markers_.length;\r\n};\r\n\r\n\r\n/**\r\n *  Sets the max zoom for the clusterer.\r\n *\r\n *  @param {number} maxZoom The max zoom level.\r\n */\r\nMarkerClusterer.prototype.setMaxZoom = function(maxZoom) {\r\n  this.maxZoom_ = maxZoom;\r\n};\r\n\r\n\r\n/**\r\n *  Gets the max zoom for the clusterer.\r\n *\r\n *  @return {number} The max zoom level.\r\n */\r\nMarkerClusterer.prototype.getMaxZoom = function() {\r\n  return this.maxZoom_;\r\n};\r\n\r\n\r\n/**\r\n *  The function for calculating the cluster icon image.\r\n *\r\n *  @param {Array.<google.maps.Marker>} markers The markers in the clusterer.\r\n *  @param {number} numStyles The number of styles available.\r\n *  @return {Object} A object properties: 'text' (string) and 'index' (number).\r\n *  @private\r\n */\r\nMarkerClusterer.prototype.calculator_ = function(markers, numStyles) {\r\n  var index = 0;\r\n  var count = markers.length;\r\n  var dv = count;\r\n  while (dv !== 0) {\r\n    dv = parseInt(dv / 10, 10);\r\n    index++;\r\n  }\r\n\r\n  index = Math.min(index, numStyles);\r\n  return {\r\n    text: count,\r\n    index: index\r\n  };\r\n};\r\n\r\n\r\n/**\r\n * Set the calculator function.\r\n *\r\n * @param {function(Array, number)} calculator The function to set as the\r\n *     calculator. The function should return a object properties:\r\n *     'text' (string) and 'index' (number).\r\n *\r\n */\r\nMarkerClusterer.prototype.setCalculator = function(calculator) {\r\n  this.calculator_ = calculator;\r\n};\r\n\r\n\r\n/**\r\n * Get the calculator function.\r\n *\r\n * @return {function(Array, number)} the calculator function.\r\n */\r\nMarkerClusterer.prototype.getCalculator = function() {\r\n  return this.calculator_;\r\n};\r\n\r\n\r\n/**\r\n * Add an array of markers to the clusterer.\r\n *\r\n * @param {Array.<google.maps.Marker>} markers The markers to add.\r\n * @param {boolean=} opt_nodraw Whether to redraw the clusters.\r\n */\r\nMarkerClusterer.prototype.addMarkers = function(markers, opt_nodraw) {\r\n  if (markers.length) {\r\n    for (var i = 0, marker; marker = markers[i]; i++) {\r\n      this.pushMarkerTo_(marker);\r\n    }\r\n  } else if (Object.keys(markers).length) {\r\n    for (var marker in markers) {\r\n      this.pushMarkerTo_(markers[marker]);\r\n    }\r\n  }\r\n  if (!opt_nodraw) {\r\n    this.redraw();\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Pushes a marker to the clusterer.\r\n *\r\n * @param {google.maps.Marker} marker The marker to add.\r\n * @private\r\n */\r\nMarkerClusterer.prototype.pushMarkerTo_ = function(marker) {\r\n  marker.isAdded = false;\r\n  if (marker['draggable']) {\r\n    // If the marker is draggable add a listener so we update the clusters on\r\n    // the drag end.\r\n    var that = this;\r\n    google.maps.event.addListener(marker, 'dragend', function() {\r\n      marker.isAdded = false;\r\n      that.repaint();\r\n    });\r\n  }\r\n  this.markers_.push(marker);\r\n};\r\n\r\n\r\n/**\r\n * Adds a marker to the clusterer and redraws if needed.\r\n *\r\n * @param {google.maps.Marker} marker The marker to add.\r\n * @param {boolean=} opt_nodraw Whether to redraw the clusters.\r\n */\r\nMarkerClusterer.prototype.addMarker = function(marker, opt_nodraw) {\r\n  this.pushMarkerTo_(marker);\r\n  if (!opt_nodraw) {\r\n    this.redraw();\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Removes a marker and returns true if removed, false if not\r\n *\r\n * @param {google.maps.Marker} marker The marker to remove\r\n * @return {boolean} Whether the marker was removed or not\r\n * @private\r\n */\r\nMarkerClusterer.prototype.removeMarker_ = function(marker) {\r\n  var index = -1;\r\n  if (this.markers_.indexOf) {\r\n    index = this.markers_.indexOf(marker);\r\n  } else {\r\n    for (var i = 0, m; m = this.markers_[i]; i++) {\r\n      if (m == marker) {\r\n        index = i;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (index == -1) {\r\n    // Marker is not in our list of markers.\r\n    return false;\r\n  }\r\n\r\n  marker.setMap(null);\r\n\r\n  this.markers_.splice(index, 1);\r\n\r\n  return true;\r\n};\r\n\r\n\r\n/**\r\n * Remove a marker from the cluster.\r\n *\r\n * @param {google.maps.Marker} marker The marker to remove.\r\n * @param {boolean=} opt_nodraw Optional boolean to force no redraw.\r\n * @return {boolean} True if the marker was removed.\r\n */\r\nMarkerClusterer.prototype.removeMarker = function(marker, opt_nodraw) {\r\n  var removed = this.removeMarker_(marker);\r\n\r\n  if (!opt_nodraw && removed) {\r\n    this.resetViewport();\r\n    this.redraw();\r\n    return true;\r\n  } else {\r\n   return false;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Removes an array of markers from the cluster.\r\n *\r\n * @param {Array.<google.maps.Marker>} markers The markers to remove.\r\n * @param {boolean=} opt_nodraw Optional boolean to force no redraw.\r\n */\r\nMarkerClusterer.prototype.removeMarkers = function(markers, opt_nodraw) {\r\n  // create a local copy of markers if required\r\n  // (removeMarker_ modifies the getMarkers() array in place)\r\n  var markersCopy = markers === this.getMarkers() ? markers.slice() : markers;\r\n  var removed = false;\r\n\r\n  for (var i = 0, marker; marker = markersCopy[i]; i++) {\r\n    var r = this.removeMarker_(marker);\r\n    removed = removed || r;\r\n  }\r\n\r\n  if (!opt_nodraw && removed) {\r\n    this.resetViewport();\r\n    this.redraw();\r\n    return true;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Sets the clusterer's ready state.\r\n *\r\n * @param {boolean} ready The state.\r\n * @private\r\n */\r\nMarkerClusterer.prototype.setReady_ = function(ready) {\r\n  if (!this.ready_) {\r\n    this.ready_ = ready;\r\n    this.createClusters_();\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Returns the number of clusters in the clusterer.\r\n *\r\n * @return {number} The number of clusters.\r\n */\r\nMarkerClusterer.prototype.getTotalClusters = function() {\r\n  return this.clusters_.length;\r\n};\r\n\r\n\r\n/**\r\n * Returns the google map that the clusterer is associated with.\r\n *\r\n * @return {google.maps.Map} The map.\r\n */\r\nMarkerClusterer.prototype.getMap = function() {\r\n  return this.map_;\r\n};\r\n\r\n\r\n/**\r\n * Sets the google map that the clusterer is associated with.\r\n *\r\n * @param {google.maps.Map} map The map.\r\n */\r\nMarkerClusterer.prototype.setMap = function(map) {\r\n  this.map_ = map;\r\n};\r\n\r\n\r\n/**\r\n * Returns the size of the grid.\r\n *\r\n * @return {number} The grid size.\r\n */\r\nMarkerClusterer.prototype.getGridSize = function() {\r\n  return this.gridSize_;\r\n};\r\n\r\n\r\n/**\r\n * Sets the size of the grid.\r\n *\r\n * @param {number} size The grid size.\r\n */\r\nMarkerClusterer.prototype.setGridSize = function(size) {\r\n  this.gridSize_ = size;\r\n};\r\n\r\n\r\n/**\r\n * Returns the min cluster size.\r\n *\r\n * @return {number} The grid size.\r\n */\r\nMarkerClusterer.prototype.getMinClusterSize = function() {\r\n  return this.minClusterSize_;\r\n};\r\n\r\n/**\r\n * Sets the min cluster size.\r\n *\r\n * @param {number} size The grid size.\r\n */\r\nMarkerClusterer.prototype.setMinClusterSize = function(size) {\r\n  this.minClusterSize_ = size;\r\n};\r\n\r\n\r\n/**\r\n * Extends a bounds object by the grid size.\r\n *\r\n * @param {google.maps.LatLngBounds} bounds The bounds to extend.\r\n * @return {google.maps.LatLngBounds} The extended bounds.\r\n */\r\nMarkerClusterer.prototype.getExtendedBounds = function(bounds) {\r\n  var projection = this.getProjection();\r\n\r\n  // Turn the bounds into latlng.\r\n  var tr = new google.maps.LatLng(bounds.getNorthEast().lat(),\r\n      bounds.getNorthEast().lng());\r\n  var bl = new google.maps.LatLng(bounds.getSouthWest().lat(),\r\n      bounds.getSouthWest().lng());\r\n\r\n  // Convert the points to pixels and the extend out by the grid size.\r\n  var trPix = projection.fromLatLngToDivPixel(tr);\r\n  trPix.x += this.gridSize_;\r\n  trPix.y -= this.gridSize_;\r\n\r\n  var blPix = projection.fromLatLngToDivPixel(bl);\r\n  blPix.x -= this.gridSize_;\r\n  blPix.y += this.gridSize_;\r\n\r\n  // Convert the pixel points back to LatLng\r\n  var ne = projection.fromDivPixelToLatLng(trPix);\r\n  var sw = projection.fromDivPixelToLatLng(blPix);\r\n\r\n  // Extend the bounds to contain the new bounds.\r\n  bounds.extend(ne);\r\n  bounds.extend(sw);\r\n\r\n  return bounds;\r\n};\r\n\r\n\r\n/**\r\n * Determins if a marker is contained in a bounds.\r\n *\r\n * @param {google.maps.Marker} marker The marker to check.\r\n * @param {google.maps.LatLngBounds} bounds The bounds to check against.\r\n * @return {boolean} True if the marker is in the bounds.\r\n * @private\r\n */\r\nMarkerClusterer.prototype.isMarkerInBounds_ = function(marker, bounds) {\r\n  return bounds.contains(marker.getPosition());\r\n};\r\n\r\n\r\n/**\r\n * Clears all clusters and markers from the clusterer.\r\n */\r\nMarkerClusterer.prototype.clearMarkers = function() {\r\n  this.resetViewport(true);\r\n\r\n  // Set the markers a empty array.\r\n  this.markers_ = [];\r\n};\r\n\r\n\r\n/**\r\n * Clears all existing clusters and recreates them.\r\n * @param {boolean} opt_hide To also hide the marker.\r\n */\r\nMarkerClusterer.prototype.resetViewport = function(opt_hide) {\r\n  // Remove all the clusters\r\n  for (var i = 0, cluster; cluster = this.clusters_[i]; i++) {\r\n    cluster.remove();\r\n  }\r\n\r\n  // Reset the markers to not be added and to be invisible.\r\n  for (var i = 0, marker; marker = this.markers_[i]; i++) {\r\n    marker.isAdded = false;\r\n    if (opt_hide) {\r\n      marker.setMap(null);\r\n    }\r\n  }\r\n\r\n  this.clusters_ = [];\r\n};\r\n\r\n/**\r\n *\r\n */\r\nMarkerClusterer.prototype.repaint = function() {\r\n  var oldClusters = this.clusters_.slice();\r\n  this.clusters_.length = 0;\r\n  this.resetViewport();\r\n  this.redraw();\r\n\r\n  // Remove the old clusters.\r\n  // Do it in a timeout so the other clusters have been drawn first.\r\n  window.setTimeout(function() {\r\n    for (var i = 0, cluster; cluster = oldClusters[i]; i++) {\r\n      cluster.remove();\r\n    }\r\n  }, 0);\r\n};\r\n\r\n\r\n/**\r\n * Redraws the clusters.\r\n */\r\nMarkerClusterer.prototype.redraw = function() {\r\n  this.createClusters_();\r\n};\r\n\r\n\r\n/**\r\n * Calculates the distance between two latlng locations in km.\r\n * @see http://www.movable-type.co.uk/scripts/latlong.html\r\n *\r\n * @param {google.maps.LatLng} p1 The first lat lng point.\r\n * @param {google.maps.LatLng} p2 The second lat lng point.\r\n * @return {number} The distance between the two points in km.\r\n * @private\r\n*/\r\nMarkerClusterer.prototype.distanceBetweenPoints_ = function(p1, p2) {\r\n  if (!p1 || !p2) {\r\n    return 0;\r\n  }\r\n\r\n  var R = 6371; // Radius of the Earth in km\r\n  var dLat = (p2.lat() - p1.lat()) * Math.PI / 180;\r\n  var dLon = (p2.lng() - p1.lng()) * Math.PI / 180;\r\n  var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n    Math.cos(p1.lat() * Math.PI / 180) * Math.cos(p2.lat() * Math.PI / 180) *\r\n    Math.sin(dLon / 2) * Math.sin(dLon / 2);\r\n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n  var d = R * c;\r\n  return d;\r\n};\r\n\r\n\r\n/**\r\n * Add a marker to a cluster, or creates a new cluster.\r\n *\r\n * @param {google.maps.Marker} marker The marker to add.\r\n * @private\r\n */\r\nMarkerClusterer.prototype.addToClosestCluster_ = function(marker) {\r\n  var distance = 40000; // Some large number\r\n  var clusterToAddTo = null;\r\n  var pos = marker.getPosition();\r\n  for (var i = 0, cluster; cluster = this.clusters_[i]; i++) {\r\n    var center = cluster.getCenter();\r\n    if (center) {\r\n      var d = this.distanceBetweenPoints_(center, marker.getPosition());\r\n      if (d < distance) {\r\n        distance = d;\r\n        clusterToAddTo = cluster;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (clusterToAddTo && clusterToAddTo.isMarkerInClusterBounds(marker)) {\r\n    clusterToAddTo.addMarker(marker);\r\n  } else {\r\n    var cluster = new Cluster(this);\r\n    cluster.addMarker(marker);\r\n    this.clusters_.push(cluster);\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Creates the clusters.\r\n *\r\n * @private\r\n */\r\nMarkerClusterer.prototype.createClusters_ = function() {\r\n  if (!this.ready_) {\r\n    return;\r\n  }\r\n\r\n  // Get our current map view bounds.\r\n  // Create a new bounds object so we don't affect the map.\r\n  var mapBounds = new google.maps.LatLngBounds(this.map_.getBounds().getSouthWest(),\r\n      this.map_.getBounds().getNorthEast());\r\n  var bounds = this.getExtendedBounds(mapBounds);\r\n\r\n  for (var i = 0, marker; marker = this.markers_[i]; i++) {\r\n    if (!marker.isAdded && this.isMarkerInBounds_(marker, bounds)) {\r\n      this.addToClosestCluster_(marker);\r\n    }\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * A cluster that contains markers.\r\n *\r\n * @param {MarkerClusterer} markerClusterer The markerclusterer that this\r\n *     cluster is associated with.\r\n * @constructor\r\n * @ignore\r\n */\r\nfunction Cluster(markerClusterer) {\r\n  this.markerClusterer_ = markerClusterer;\r\n  this.map_ = markerClusterer.getMap();\r\n  this.gridSize_ = markerClusterer.getGridSize();\r\n  this.minClusterSize_ = markerClusterer.getMinClusterSize();\r\n  this.averageCenter_ = markerClusterer.isAverageCenter();\r\n  this.center_ = null;\r\n  this.markers_ = [];\r\n  this.bounds_ = null;\r\n  this.clusterIcon_ = new ClusterIcon(this, markerClusterer.getStyles(),\r\n      markerClusterer.getGridSize());\r\n}\r\n\r\n/**\r\n * Determins if a marker is already added to the cluster.\r\n *\r\n * @param {google.maps.Marker} marker The marker to check.\r\n * @return {boolean} True if the marker is already added.\r\n */\r\nCluster.prototype.isMarkerAlreadyAdded = function(marker) {\r\n  if (this.markers_.indexOf) {\r\n    return this.markers_.indexOf(marker) != -1;\r\n  } else {\r\n    for (var i = 0, m; m = this.markers_[i]; i++) {\r\n      if (m == marker) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\n\r\n/**\r\n * Add a marker the cluster.\r\n *\r\n * @param {google.maps.Marker} marker The marker to add.\r\n * @return {boolean} True if the marker was added.\r\n */\r\nCluster.prototype.addMarker = function(marker) {\r\n  if (this.isMarkerAlreadyAdded(marker)) {\r\n    return false;\r\n  }\r\n\r\n  if (!this.center_) {\r\n    this.center_ = marker.getPosition();\r\n    this.calculateBounds_();\r\n  } else {\r\n    if (this.averageCenter_) {\r\n      var l = this.markers_.length + 1;\r\n      var lat = (this.center_.lat() * (l-1) + marker.getPosition().lat()) / l;\r\n      var lng = (this.center_.lng() * (l-1) + marker.getPosition().lng()) / l;\r\n      this.center_ = new google.maps.LatLng(lat, lng);\r\n      this.calculateBounds_();\r\n    }\r\n  }\r\n\r\n  marker.isAdded = true;\r\n  this.markers_.push(marker);\r\n\r\n  var len = this.markers_.length;\r\n  if (len < this.minClusterSize_ && marker.getMap() != this.map_) {\r\n    // Min cluster size not reached so show the marker.\r\n    marker.setMap(this.map_);\r\n  }\r\n\r\n  if (len == this.minClusterSize_) {\r\n    // Hide the markers that were showing.\r\n    for (var i = 0; i < len; i++) {\r\n      this.markers_[i].setMap(null);\r\n    }\r\n  }\r\n\r\n  if (len >= this.minClusterSize_) {\r\n    marker.setMap(null);\r\n  }\r\n\r\n  this.updateIcon();\r\n  return true;\r\n};\r\n\r\n\r\n/**\r\n * Returns the marker clusterer that the cluster is associated with.\r\n *\r\n * @return {MarkerClusterer} The associated marker clusterer.\r\n */\r\nCluster.prototype.getMarkerClusterer = function() {\r\n  return this.markerClusterer_;\r\n};\r\n\r\n\r\n/**\r\n * Returns the bounds of the cluster.\r\n *\r\n * @return {google.maps.LatLngBounds} the cluster bounds.\r\n */\r\nCluster.prototype.getBounds = function() {\r\n  var bounds = new google.maps.LatLngBounds(this.center_, this.center_);\r\n  var markers = this.getMarkers();\r\n  for (var i = 0, marker; marker = markers[i]; i++) {\r\n    bounds.extend(marker.getPosition());\r\n  }\r\n  return bounds;\r\n};\r\n\r\n\r\n/**\r\n * Removes the cluster\r\n */\r\nCluster.prototype.remove = function() {\r\n  this.clusterIcon_.remove();\r\n  this.markers_.length = 0;\r\n  delete this.markers_;\r\n};\r\n\r\n\r\n/**\r\n * Returns the number of markers in the cluster.\r\n *\r\n * @return {number} The number of markers in the cluster.\r\n */\r\nCluster.prototype.getSize = function() {\r\n  return this.markers_.length;\r\n};\r\n\r\n\r\n/**\r\n * Returns a list of the markers in the cluster.\r\n *\r\n * @return {Array.<google.maps.Marker>} The markers in the cluster.\r\n */\r\nCluster.prototype.getMarkers = function() {\r\n  return this.markers_;\r\n};\r\n\r\n\r\n/**\r\n * Returns the center of the cluster.\r\n *\r\n * @return {google.maps.LatLng} The cluster center.\r\n */\r\nCluster.prototype.getCenter = function() {\r\n  return this.center_;\r\n};\r\n\r\n\r\n/**\r\n * Calculated the extended bounds of the cluster with the grid.\r\n *\r\n * @private\r\n */\r\nCluster.prototype.calculateBounds_ = function() {\r\n  var bounds = new google.maps.LatLngBounds(this.center_, this.center_);\r\n  this.bounds_ = this.markerClusterer_.getExtendedBounds(bounds);\r\n};\r\n\r\n\r\n/**\r\n * Determines if a marker lies in the clusters bounds.\r\n *\r\n * @param {google.maps.Marker} marker The marker to check.\r\n * @return {boolean} True if the marker lies in the bounds.\r\n */\r\nCluster.prototype.isMarkerInClusterBounds = function(marker) {\r\n  return this.bounds_.contains(marker.getPosition());\r\n};\r\n\r\n\r\n/**\r\n * Returns the map that the cluster is associated with.\r\n *\r\n * @return {google.maps.Map} The map.\r\n */\r\nCluster.prototype.getMap = function() {\r\n  return this.map_;\r\n};\r\n\r\n\r\n/**\r\n * Updates the cluster icon\r\n */\r\nCluster.prototype.updateIcon = function() {\r\n  var zoom = this.map_.getZoom();\r\n  var mz = this.markerClusterer_.getMaxZoom();\r\n\r\n  if (mz && zoom > mz) {\r\n    // The zoom is greater than our max zoom so show all the markers in cluster.\r\n    for (var i = 0, marker; marker = this.markers_[i]; i++) {\r\n      marker.setMap(this.map_);\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (this.markers_.length < this.minClusterSize_) {\r\n    // Min cluster size not yet reached.\r\n    this.clusterIcon_.hide();\r\n    return;\r\n  }\r\n\r\n  var numStyles = this.markerClusterer_.getStyles().length;\r\n  var sums = this.markerClusterer_.getCalculator()(this.markers_, numStyles);\r\n  this.clusterIcon_.setCenter(this.center_);\r\n  this.clusterIcon_.setSums(sums);\r\n  this.clusterIcon_.show();\r\n};\r\n\r\n\r\n/**\r\n * A cluster icon\r\n *\r\n * @param {Cluster} cluster The cluster to be associated with.\r\n * @param {Object} styles An object that has style properties:\r\n *     'url': (string) The image url.\r\n *     'height': (number) The image height.\r\n *     'width': (number) The image width.\r\n *     'anchor': (Array) The anchor position of the label text.\r\n *     'textColor': (string) The text color.\r\n *     'textSize': (number) The text size.\r\n *     'backgroundPosition: (string) The background postition x, y.\r\n * @param {number=} opt_padding Optional padding to apply to the cluster icon.\r\n * @constructor\r\n * @extends google.maps.OverlayView\r\n * @ignore\r\n */\r\nfunction ClusterIcon(cluster, styles, opt_padding) {\r\n  cluster.getMarkerClusterer().extend(ClusterIcon, google.maps.OverlayView);\r\n\r\n  this.styles_ = styles;\r\n  this.padding_ = opt_padding || 0;\r\n  this.cluster_ = cluster;\r\n  this.center_ = null;\r\n  this.map_ = cluster.getMap();\r\n  this.div_ = null;\r\n  this.sums_ = null;\r\n  this.visible_ = false;\r\n\r\n  this.setMap(this.map_);\r\n}\r\n\r\n\r\n/**\r\n * Triggers the clusterclick event and zoom's if the option is set.\r\n */\r\nClusterIcon.prototype.triggerClusterClick = function() {\r\n  var markerClusterer = this.cluster_.getMarkerClusterer();\r\n\r\n  // Trigger the clusterclick event.\r\n  google.maps.event.trigger(markerClusterer, 'clusterclick', this.cluster_);\r\n\r\n  if (markerClusterer.isZoomOnClick()) {\r\n    // Zoom into the cluster.\r\n    this.map_.fitBounds(this.cluster_.getBounds());\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Adding the cluster icon to the dom.\r\n * @ignore\r\n */\r\nClusterIcon.prototype.onAdd = function() {\r\n  this.div_ = document.createElement('DIV');\r\n  var panes = this.getPanes();\r\n  if (this.visible_) {\r\n    var pos = this.getPosFromLatLng_(this.center_);\r\n    this.div_.style.cssText = this.createCss(pos);\r\n    this.div_.innerHTML = this.sums_.text;\r\n    if( this.sums_.text ){\r\n      panes.overlayMouseTarget.classList.add('shiftms-map-cluster-icon');\r\n      if( this.sums_.text > 1000 ){\r\n        this.div_.classList.add('shiftms-map-cluster-icon-large-num');\r\n      }\r\n\r\n      if( this.sums_.text > 0 ){\r\n        this.div_.classList.add('shiftms-map-cluster-icon-is-cluster');  \r\n      }\r\n    }\r\n  }\r\n\r\n  panes.overlayMouseTarget.appendChild(this.div_);\r\n\r\n  var that = this;\r\n  google.maps.event.addDomListener(this.div_, 'click', function() {\r\n    that.triggerClusterClick();\r\n  });\r\n};\r\n\r\n\r\n/**\r\n * Returns the position to place the div dending on the latlng.\r\n *\r\n * @param {google.maps.LatLng} latlng The position in latlng.\r\n * @return {google.maps.Point} The position in pixels.\r\n * @private\r\n */\r\nClusterIcon.prototype.getPosFromLatLng_ = function(latlng) {\r\n  var pos = this.getProjection().fromLatLngToDivPixel(latlng);\r\n  pos.x -= parseInt(this.width_ / 2, 10);\r\n  pos.y -= parseInt(this.height_ / 2, 10);\r\n  return pos;\r\n};\r\n\r\n\r\n/**\r\n * Draw the icon.\r\n * @ignore\r\n */\r\nClusterIcon.prototype.draw = function() {\r\n  if (this.visible_) {\r\n    var pos = this.getPosFromLatLng_(this.center_);\r\n    this.div_.style.top = pos.y + 'px';\r\n    this.div_.style.left = pos.x + 'px';\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Hide the icon.\r\n */\r\nClusterIcon.prototype.hide = function() {\r\n  if (this.div_) {\r\n    this.div_.style.display = 'none';\r\n  }\r\n  this.visible_ = false;\r\n};\r\n\r\n\r\n/**\r\n * Position and show the icon.\r\n */\r\nClusterIcon.prototype.show = function() {\r\n  if (this.div_) {\r\n    var pos = this.getPosFromLatLng_(this.center_);\r\n    this.div_.style.cssText = this.createCss(pos);\r\n    this.div_.style.display = '';\r\n  }\r\n  this.visible_ = true;\r\n};\r\n\r\n\r\n/**\r\n * Remove the icon from the map\r\n */\r\nClusterIcon.prototype.remove = function() {\r\n  this.setMap(null);\r\n};\r\n\r\n\r\n/**\r\n * Implementation of the onRemove interface.\r\n * @ignore\r\n */\r\nClusterIcon.prototype.onRemove = function() {\r\n  if (this.div_ && this.div_.parentNode) {\r\n    this.hide();\r\n    this.div_.parentNode.removeChild(this.div_);\r\n    this.div_ = null;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Set the sums of the icon.\r\n *\r\n * @param {Object} sums The sums containing:\r\n *   'text': (string) The text to display in the icon.\r\n *   'index': (number) The style index of the icon.\r\n */\r\nClusterIcon.prototype.setSums = function(sums) {\r\n  this.sums_ = sums;\r\n  this.text_ = sums.text;\r\n  this.index_ = sums.index;\r\n  if (this.div_) {\r\n    this.div_.innerHTML = sums.text;\r\n  }\r\n\r\n  this.useStyle();\r\n};\r\n\r\n\r\n/**\r\n * Sets the icon to the the styles.\r\n */\r\nClusterIcon.prototype.useStyle = function() {\r\n  var index = Math.max(0, this.sums_.index - 1);\r\n  index = Math.min(this.styles_.length - 1, index);\r\n  var style = this.styles_[index];\r\n  this.url_ = style['url'];\r\n  this.height_ = style['height'];\r\n  this.width_ = style['width'];\r\n  this.textColor_ = style['textColor'];\r\n  this.anchor_ = style['anchor'];\r\n  this.textSize_ = style['textSize'];\r\n  this.backgroundPosition_ = style['backgroundPosition'];\r\n};\r\n\r\n\r\n/**\r\n * Sets the center of the icon.\r\n *\r\n * @param {google.maps.LatLng} center The latlng to set as the center.\r\n */\r\nClusterIcon.prototype.setCenter = function(center) {\r\n  this.center_ = center;\r\n};\r\n\r\n\r\n/**\r\n * Create the css text based on the position of the icon.\r\n *\r\n * @param {google.maps.Point} pos The position.\r\n * @return {string} The css style text.\r\n */\r\nClusterIcon.prototype.createCss = function(pos) {\r\n  var style = [];\r\n  style.push('background-image:url(' + this.url_ + ');');\r\n  var backgroundPosition = this.backgroundPosition_ ? this.backgroundPosition_ : '0 0';\r\n  style.push('background-position:' + backgroundPosition + ';');\r\n\r\n  if (typeof this.anchor_ === 'object') {\r\n    if (typeof this.anchor_[0] === 'number' && this.anchor_[0] > 0 &&\r\n        this.anchor_[0] < this.height_) {\r\n      style.push('height:' + (this.height_ - this.anchor_[0]) +\r\n          'px; padding-top:' + this.anchor_[0] + 'px;');\r\n    } else {\r\n      style.push('height:' + this.height_ + 'px; line-height:' + this.height_ +\r\n          'px;');\r\n    }\r\n    if (typeof this.anchor_[1] === 'number' && this.anchor_[1] > 0 &&\r\n        this.anchor_[1] < this.width_) {\r\n      style.push('width:' + (this.width_ - this.anchor_[1]) +\r\n          'px; padding-left:' + this.anchor_[1] + 'px;');\r\n    } else {\r\n      style.push('width:' + this.width_ + 'px; text-align:center;');\r\n    }\r\n  } else {\r\n    style.push('height:' + this.height_ + 'px; line-height:' +\r\n        this.height_ + 'px; width:' + this.width_ + 'px; text-align:center;');\r\n  }\r\n\r\n  var txtColor = this.textColor_ ? this.textColor_ : 'black';\r\n  var txtSize = this.textSize_ ? this.textSize_ : 11;\r\n\r\n  style.push('cursor:pointer; top:' + pos.y + 'px; left:' +\r\n      pos.x + 'px; color:' + txtColor + '; position:absolute; font-size:' +\r\n      txtSize + 'px; font-family:Arial,sans-serif; font-weight:bold');\r\n  return style.join('');\r\n};\r\n\r\n\r\n// Export Symbols for Closure\r\n// If you are not going to compile with closure then you can remove the\r\n// code below.\r\nwindow['MarkerClusterer'] = MarkerClusterer;\r\nMarkerClusterer.prototype['addMarker'] = MarkerClusterer.prototype.addMarker;\r\nMarkerClusterer.prototype['addMarkers'] = MarkerClusterer.prototype.addMarkers;\r\nMarkerClusterer.prototype['clearMarkers'] =\r\n    MarkerClusterer.prototype.clearMarkers;\r\nMarkerClusterer.prototype['fitMapToMarkers'] =\r\n    MarkerClusterer.prototype.fitMapToMarkers;\r\nMarkerClusterer.prototype['getCalculator'] =\r\n    MarkerClusterer.prototype.getCalculator;\r\nMarkerClusterer.prototype['getGridSize'] =\r\n    MarkerClusterer.prototype.getGridSize;\r\nMarkerClusterer.prototype['getExtendedBounds'] =\r\n    MarkerClusterer.prototype.getExtendedBounds;\r\nMarkerClusterer.prototype['getMap'] = MarkerClusterer.prototype.getMap;\r\nMarkerClusterer.prototype['getMarkers'] = MarkerClusterer.prototype.getMarkers;\r\nMarkerClusterer.prototype['getMaxZoom'] = MarkerClusterer.prototype.getMaxZoom;\r\nMarkerClusterer.prototype['getStyles'] = MarkerClusterer.prototype.getStyles;\r\nMarkerClusterer.prototype['getTotalClusters'] =\r\n    MarkerClusterer.prototype.getTotalClusters;\r\nMarkerClusterer.prototype['getTotalMarkers'] =\r\n    MarkerClusterer.prototype.getTotalMarkers;\r\nMarkerClusterer.prototype['redraw'] = MarkerClusterer.prototype.redraw;\r\nMarkerClusterer.prototype['removeMarker'] =\r\n    MarkerClusterer.prototype.removeMarker;\r\nMarkerClusterer.prototype['removeMarkers'] =\r\n    MarkerClusterer.prototype.removeMarkers;\r\nMarkerClusterer.prototype['resetViewport'] =\r\n    MarkerClusterer.prototype.resetViewport;\r\nMarkerClusterer.prototype['repaint'] =\r\n    MarkerClusterer.prototype.repaint;\r\nMarkerClusterer.prototype['setCalculator'] =\r\n    MarkerClusterer.prototype.setCalculator;\r\nMarkerClusterer.prototype['setGridSize'] =\r\n    MarkerClusterer.prototype.setGridSize;\r\nMarkerClusterer.prototype['setMaxZoom'] =\r\n    MarkerClusterer.prototype.setMaxZoom;\r\nMarkerClusterer.prototype['onAdd'] = MarkerClusterer.prototype.onAdd;\r\nMarkerClusterer.prototype['draw'] = MarkerClusterer.prototype.draw;\r\n\r\nCluster.prototype['getCenter'] = Cluster.prototype.getCenter;\r\nCluster.prototype['getSize'] = Cluster.prototype.getSize;\r\nCluster.prototype['getMarkers'] = Cluster.prototype.getMarkers;\r\n\r\nClusterIcon.prototype['onAdd'] = ClusterIcon.prototype.onAdd;\r\nClusterIcon.prototype['draw'] = ClusterIcon.prototype.draw;\r\nClusterIcon.prototype['onRemove'] = ClusterIcon.prototype.onRemove;\r\n\r\nObject.keys = Object.keys || function(o) {  \r\n    var result = [];  \r\n    for(var name in o) {  \r\n        if (o.hasOwnProperty(name))  \r\n          result.push(name);  \r\n    }  \r\n    return result;  \r\n};\r\n\r\nexport default MarkerClusterer;","const $ = window.jQuery;\r\n\r\nconst createSearchBox = (map, mapWrapper) => {\r\n\tlet localMap = map;\r\n\t// Create search box and link it to UI\r\n\tconst $input = $(mapWrapper).find('input.shiftmap-input');\r\n\tconst input = $input.get(0);\r\n\tconst searchBox = new google.maps.places.SearchBox(input);\r\n\treturn searchBox;\r\n};\r\n\r\nexport default createSearchBox;\r\n","// Cluster markers SVG\r\nconst Symbol = (id, width, height, fill) => {\r\n\tconst marker_svg = {\r\n\t\tmarker: {\r\n\t\t\tp: 'M244.31,0C256.87,2.49,269.59,4.38,282,7.58c35.11,9.1,65.15,27.29,90.44,53.07C401.19,90,419.56,125,427,165.51q12.58,68.25-18.92,130.11Q319.47,469.54,230.64,643.36c-.73,1.42-1.59,2.78-2.79,4.87-1.41-2.43-2.5-4.14-3.42-5.93C165.11,526,104.62,410.27,46.93,293.17,8.94,216.08,18.43,141.32,71.6,74c34-43,80.17-66.6,134.87-72.86A44.62,44.62,0,0,0,211.37,0Z',\r\n\t\t\tv: \"0 0 430.62 648.23\"\r\n\t\t}\r\n\t};\r\n\treturn ('data:image/svg+xml;base64,' + window.btoa('<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"' + height + '\" viewBox=\"0 0 430.62 648.23\" width=\"' + width + '\" ><g><path fill=\"' + fill + '\" d=\"' + marker_svg[id].p + '\" /></g></svg>'));\r\n};\r\n\r\nexport default Symbol;","// Map colors\r\nconst land = \"#EEEFF1\";\r\nconst water = \"#54b1db\";\r\n\r\nconst mapStyles = [\r\n\t\t{\r\n\t\t\t\"elementType\": \"labels\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"visibility\": \"off\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"featureType\": \"administrative\",\r\n\t\t\t\"elementType\": \"geometry\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"visibility\": \"off\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"featureType\": \"administrative.land_parcel\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"visibility\": \"off\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"featureType\": \"administrative.neighborhood\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"visibility\": \"off\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"featureType\": \"landscape.man_made\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"color\": land\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"featureType\": \"landscape.natural\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"color\": land\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"featureType\": \"landscape.natural.landcover\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"color\": land\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"featureType\": \"landscape.natural.terrain\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"color\": land\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"featureType\": \"poi\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"visibility\": \"off\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"featureType\": \"road\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"visibility\": \"off\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"featureType\": \"road\",\r\n\t\t\t\"elementType\": \"labels.icon\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"visibility\": \"off\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"featureType\": \"transit\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"visibility\": \"off\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"featureType\": \"water\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"color\": water\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t];\r\n\r\nexport default mapStyles;\r\n\r\nexport var mapDetailStyles = [\r\n  {\r\n    \"featureType\": \"road.arterial\",\r\n    \"stylers\": [\r\n      {\r\n        \"visibility\": \"off\"\r\n      }\r\n    ]\r\n  },\r\n  {\r\n    \"featureType\": \"road.highway\",\r\n    \"elementType\": \"labels\",\r\n    \"stylers\": [\r\n      {\r\n        \"visibility\": \"off\"\r\n      }\r\n    ]\r\n  },\r\n  {\r\n    \"featureType\": \"road.local\",\r\n    \"stylers\": [\r\n      {\r\n        \"visibility\": \"off\"\r\n      }\r\n    ]\r\n  },\r\n\t{\r\n\t\t\"featureType\": \"water\",\r\n\t\t\"stylers\": [\r\n\t\t\t{\r\n\t\t\t\t\"color\": water\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\t\"featureType\": \"landscape.man_made\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"color\": land\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"featureType\": \"landscape.natural\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"color\": land\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"featureType\": \"landscape.natural.landcover\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"color\": land\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"featureType\": \"landscape.natural.terrain\",\r\n\t\t\t\"stylers\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"color\": land\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n];\r\n","const defineCenter = (lat, lng) =>  new google.maps.LatLng(parseFloat(lat).toFixed(6), parseFloat(lng).toFixed(6));\r\n\r\nexport default defineCenter;\r\n","import Symbol from './svgMarkers';\r\nimport mapStyles from './mapStyles';\r\nimport defineCenter from './defineCenter';\r\n\r\nlet options = {};\r\nlet clusterOptions = {};\r\n\r\n// Map options\r\nconst getMapOptions = () => {\r\n\t$.extend(options, {\r\n\t\tzoom: 3,\r\n\t\tcenter: defineCenter(51.521723, -0.134581),\r\n\t\tmapTypeId: google.maps.MapTypeId.ROADMAP,\r\n\t\tmapTypeControl: false,\r\n\t\tstyles: mapStyles,\r\n\t\tminZoom: 2\r\n\t});\r\n\r\n\treturn options;\r\n}\r\n\r\n// Cluster markers style\r\nconst clusterStyles = [\r\n\t{\r\n\t\tanchor: [17, 35],\r\n\t\ttextColor: 'white',\r\n\t\ttextSize: '16',\r\n\t\turl: './img/icons/icon-2.svg',\r\n\t\theight: 75,\r\n\t\twidth: 75,\r\n\t},\r\n\t{\r\n\t\tanchor: [25, 42],\r\n\t\ttextColor: 'white',\r\n\t\ttextSize: '18',\r\n\t\turl: './img/icons/icon-2.svg',\r\n\t\theight: 100,\r\n\t\twidth: 100,\r\n\t},\r\n\t{\r\n\t\tanchor: [32, 42],\r\n\t\ttextColor: 'white',\r\n\t\ttextSize: '26',\r\n\t\turl: './img/icons/icon-2.svg',\r\n\t\theight: 125,\r\n\t\twidth: 125,\r\n\t},\r\n];\r\n\r\n// Cluster options\r\nconst getClusterOptions = () => {\r\n\t$.extend(clusterOptions, {\r\n\t\tmaxZoom: 12,\r\n\t\tgridSize: 75,\r\n\t\tstyles: clusterStyles,\r\n\t});\r\n\treturn clusterOptions;\r\n}\r\n\r\n// Set new icon\r\nconst setIcon = (newIcon) => {\r\n\treturn newIcon;\r\n};\r\n\r\nconst addCenterToOptions = (center) => {\r\n\toptions.center = center;\r\n};\r\n\r\n// Icon\r\nconst getIcon = () => {\r\n\treturn {\r\n\t\turl: Symbol('marker', 25, 25, '#f16667'),\r\n\t\tsize: new google.maps.Size(71, 71),\r\n\t\torigin: new google.maps.Point(0, 0),\r\n\t\tanchor: new google.maps.Point(17, 34),\r\n\t\tscaledSize: new google.maps.Size(25, 25),\r\n\t};\r\n}\r\n\r\nconst getIconPlace = () => {\r\n\treturn {\r\n\t\turl: Symbol('marker', 50, 50, '#77bf2f'),\r\n\t\tsize: new google.maps.Size(50, 50),\r\n\t\torigin: new google.maps.Point(0, 0),\r\n\t\tanchor: new google.maps.Point(25, 50)\r\n\t}\r\n}\r\n\r\nexport {\r\n\tgetIcon,\r\n\tgetClusterOptions,\r\n\tsetIcon,\r\n\taddCenterToOptions,\r\n\tgetMapOptions,\r\n\tgetIconPlace\r\n};\r\n","import {getIconPlace} from '../map/options';\r\nimport confirmLocationContent from './confirmLocation.html';\r\n\r\nconst searchBox = (map, places, sBox, placeMarkers, getIcon, setIcon) => {\r\n\r\n\t// Bias searchbox results towards current map's viewport\r\n\tmap.addListener('bounds_changed', function() {\r\n\t\tsBox.setBounds(map.getBounds());\r\n\t});\r\n\r\n\t// Listen for the event fired when the user selects a prediction and retrieve\r\n\t// more details for that place.\r\n\tsBox.addListener('places_changed', function() {\r\n\r\n\t\tconst isPlotSearch = $('.shiftmap-promo-area.in').length;\r\n\r\n\t\tplaces = sBox.getPlaces();\r\n\t\tif (places.length == 0) {\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\t// Only one result\r\n\t\t\tplaces = [places[0]];\r\n\t\t}\r\n\r\n\t\t// Clear out the old markers.\r\n\t\tplaceMarkers.forEach(function(marker) {\r\n\t\t\tmarker.setMap(null);\r\n\t\t});\r\n\t\tplaceMarkers = [];\r\n\r\n\t\t// For each place, get the icon, name and location.\r\n\t\tlet bounds = new google.maps.LatLngBounds();\r\n\t\tplaces.forEach(function(place) {\r\n\t\t\tif (!place.geometry) {\r\n\t\t\t\tconsole.log(\"Returned place contains no geometry\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet marker;\r\n\r\n\t\t\tif( isPlotSearch ){\r\n\r\n\t\t\t\tmarker = new google.maps.Marker({\r\n\t\t\t\t\tmap: map,\r\n\t\t\t\t\ticon: getIconPlace(),\r\n\t\t\t\t\ttitle: place.name,\r\n\t\t\t\t\tposition: place.geometry.location,\r\n\t\t\t\t\toptimized: false,\r\n\t\t\t\t\tzindex: 2,\r\n\t\t\t\t\tclass: 'shiftms-map-cluster-location-icon'\r\n\t\t\t\t});\r\n\r\n\t\t\t\tplaceMarkers.push(marker);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (place.geometry.viewport) {\r\n\t\t\t\t// Only geocodes have viewport.\r\n\t\t\t\tbounds.union(place.geometry.viewport);\r\n\t\t\t} else {\r\n\t\t\t\tbounds.extend(place.geometry.location);\r\n\t\t\t}\r\n\r\n\t\t\tmap.fitBounds(bounds);\r\n\r\n\t\t\tgoogle.maps.event.addListenerOnce(map, \"idle\", function() { \r\n\t\t\t\tif( isPlotSearch ){\r\n\t\t\t\t\tconst infoWindow = createInfoWindow(map, marker, place);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tgoogle.maps.event.addListenerOnce(map, \"idle\", function() { \r\n\r\n\t\t\t// Disable zoom, as infowindow handles this automatically\r\n\t\t\tif( ! isPlotSearch ){\r\n\t\t\t  map.setZoom(6); \r\n\t\t\t}\r\n\t\t});\r\n\r\n\t});\r\n};\r\nexport default searchBox;\r\n\r\nconst createInfoWindow = ( map, marker, place ) => {\r\n\tconst html = $(confirmLocationContent);\r\n\tvar infowindow = new google.maps.InfoWindow({\r\n      content: ''\r\n    });\r\n\r\n    infowindow.setContent(html.get(0));\r\n\r\n\thtml.find(\"button\").click(() => {\r\n\t\tgoogle.maps.event.trigger(map, 'shiftms_plotted_location', place, marker);\r\n\t\tinfowindow.close();\r\n\t\t$('html').removeClass('map-plotting-active');\r\n\t\t$('.shiftmap-promo-area').removeClass('in');\r\n\t});\r\n\r\n\tinfowindow.open(map, marker);\r\n    \r\n    return infowindow;\r\n}","import promoHtml from './promoAreaLogged.html';\r\n\r\nconst promoArea = (insertMarker, assetsPath) => {\r\n\tlet html = promoHtml;\r\n\thtml = $(promoHtml.replace('%assetspath%', assetsPath));\r\n\r\n\tconst userPanel = $('.shiftmap-map-clusterise-wrapper');\r\n\tuserPanel.prepend(html);\r\n\thtml.find('button').click(insertMarker).click(() => {\r\n\t\thtml.addClass('in');\r\n\t\t$('html').addClass('map-plotting-active');\r\n\t\tconst input = userPanel.find(\"input.shiftmap-input\").one('blur', () => {\r\n\t\t});\t\r\n\t\tsetTimeout(() => {\r\n\t\t\tinput.focus();\r\n\t\t}, 100 );\r\n\t});\r\n\r\n\thtml.find('a').click(() => {\r\n\t\thtml.removeClass('in');\r\n\t\t$('html').removeClass('map-plotting-active');\r\n\t});\r\n};\r\n\r\nexport default promoArea;","import promoHtml from './promoArea.html';\r\n\r\nconst promoArea = (insertMarker, numUsers, assetsPath) => {\r\n\tlet html = promoHtml;\r\n\thtml = $(promoHtml.replace('%total%', numUsers)\t\r\n\t\t.replace('%assetspath%', assetsPath));\r\n\r\n\tconst userPanel = $('.shiftmap-map-clusterise-wrapper');\r\n\tuserPanel.prepend(html);\r\n\thtml.find('button').click(insertMarker).click(() => {\r\n\t\thtml.addClass('in');\r\n\t\t$('html').addClass('map-plotting-active');\r\n\t\tconst input = userPanel.find(\"input.shiftmap-input\").one('blur', () => {\r\n\t\t\t// setTimeout(() => html.removeClass('in'), 500 );\r\n\t\t});\t\r\n\t\tsetTimeout(() => {\r\n\t\t\tinput.focus();\r\n\t\t}, 100 );\r\n\t});\r\n\r\n\thtml.find('a').click(() => {\r\n\t\thtml.removeClass('in');\r\n\t\t$('html').removeClass('map-plotting-active');\r\n\t});\r\n};\r\n\r\nexport default promoArea;","/*! Clusterize.js - v0.17.6 - 2017-03-05\n* http://NeXTs.github.com/Clusterize.js/\n* Copyright (c) 2015 Denis Lukov; Licensed GPLv3 */\n\n;(function(name, definition) {\n    if (typeof module != 'undefined') module.exports = definition();\n    else if (typeof define == 'function' && typeof define.amd == 'object') define(definition);\n    else this[name] = definition();\n}('Clusterize', function() {\n  \"use strict\"\n\n  // detect ie9 and lower\n  // https://gist.github.com/padolsey/527683#comment-786682\n  var ie = (function(){\n    for( var v = 3,\n             el = document.createElement('b'),\n             all = el.all || [];\n         el.innerHTML = '<!--[if gt IE ' + (++v) + ']><i><![endif]-->',\n         all[0];\n       ){}\n    return v > 4 ? v : document.documentMode;\n  }()),\n  is_mac = navigator.platform.toLowerCase().indexOf('mac') + 1;\n  var Clusterize = function(data) {\n    if( ! (this instanceof Clusterize))\n      return new Clusterize(data);\n    var self = this;\n\n    var defaults = {\n      rows_in_block: 50,\n      blocks_in_cluster: 4,\n      tag: null,\n      show_no_data_row: true,\n      no_data_class: 'clusterize-no-data',\n      no_data_text: 'No data',\n      keep_parity: true,\n      callbacks: {}\n    }\n\n    // public parameters\n    self.options = {};\n    var options = ['rows_in_block', 'blocks_in_cluster', 'show_no_data_row', 'no_data_class', 'no_data_text', 'keep_parity', 'tag', 'callbacks'];\n    for(var i = 0, option; option = options[i]; i++) {\n      self.options[option] = typeof data[option] != 'undefined' && data[option] != null\n        ? data[option]\n        : defaults[option];\n    }\n\n    var elems = ['scroll', 'content'];\n    for(var i = 0, elem; elem = elems[i]; i++) {\n      self[elem + '_elem'] = data[elem + 'Id']\n        ? document.getElementById(data[elem + 'Id'])\n        : data[elem + 'Elem'];\n      if( ! self[elem + '_elem'])\n        throw new Error(\"Error! Could not find \" + elem + \" element\");\n    }\n\n    // tabindex forces the browser to keep focus on the scrolling list, fixes #11\n    if( ! self.content_elem.hasAttribute('tabindex'))\n      self.content_elem.setAttribute('tabindex', 0);\n\n    // private parameters\n    var rows = isArray(data.rows)\n        ? data.rows\n        : self.fetchMarkup(),\n      cache = {},\n      scroll_top = self.scroll_elem.scrollTop;\n\n    // append initial data\n    self.insertToDOM(rows, cache);\n\n    // restore the scroll position\n    self.scroll_elem.scrollTop = scroll_top;\n\n    // adding scroll handler\n    var last_cluster = false,\n    scroll_debounce = 0,\n    pointer_events_set = false,\n    scrollEv = function() {\n      // fixes scrolling issue on Mac #3\n      if (is_mac) {\n          if( ! pointer_events_set) self.content_elem.style.pointerEvents = 'none';\n          pointer_events_set = true;\n          clearTimeout(scroll_debounce);\n          scroll_debounce = setTimeout(function () {\n              self.content_elem.style.pointerEvents = 'auto';\n              pointer_events_set = false;\n          }, 50);\n      }\n      if (last_cluster != (last_cluster = self.getClusterNum()))\n        self.insertToDOM(rows, cache);\n      if (self.options.callbacks.scrollingProgress)\n        self.options.callbacks.scrollingProgress(self.getScrollProgress());\n    },\n    resize_debounce = 0,\n    resizeEv = function() {\n      clearTimeout(resize_debounce);\n      resize_debounce = setTimeout(self.refresh, 100);\n    }\n    on('scroll', self.scroll_elem, scrollEv);\n    on('resize', window, resizeEv);\n\n    // public methods\n    self.destroy = function(clean) {\n      off('scroll', self.scroll_elem, scrollEv);\n      off('resize', window, resizeEv);\n      self.html((clean ? self.generateEmptyRow() : rows).join(''));\n    }\n    self.refresh = function(force) {\n      if(self.getRowsHeight(rows) || force) self.update(rows);\n    }\n    self.update = function(new_rows) {\n      rows = isArray(new_rows)\n        ? new_rows\n        : [];\n      var scroll_top = self.scroll_elem.scrollTop;\n      // fixes #39\n      if(rows.length * self.options.item_height < scroll_top) {\n        self.scroll_elem.scrollTop = 0;\n        last_cluster = 0;\n      }\n      self.insertToDOM(rows, cache);\n      self.scroll_elem.scrollTop = scroll_top;\n    }\n    self.clear = function() {\n      self.update([]);\n    }\n    self.getRowsAmount = function() {\n      return rows.length;\n    }\n    self.getScrollProgress = function() {\n      return this.options.scroll_top / (rows.length * this.options.item_height) * 100 || 0;\n    }\n\n    var add = function(where, _new_rows) {\n      var new_rows = isArray(_new_rows)\n        ? _new_rows\n        : [];\n      if( ! new_rows.length) return;\n      rows = where == 'append'\n        ? rows.concat(new_rows)\n        : new_rows.concat(rows);\n      self.insertToDOM(rows, cache);\n    }\n    self.append = function(rows) {\n      add('append', rows);\n    }\n    self.prepend = function(rows) {\n      add('prepend', rows);\n    }\n  }\n\n  Clusterize.prototype = {\n    constructor: Clusterize,\n    // fetch existing markup\n    fetchMarkup: function() {\n      var rows = [], rows_nodes = this.getChildNodes(this.content_elem);\n      while (rows_nodes.length) {\n        rows.push(rows_nodes.shift().outerHTML);\n      }\n      return rows;\n    },\n    // get tag name, content tag name, tag height, calc cluster height\n    exploreEnvironment: function(rows, cache) {\n      var opts = this.options;\n      opts.content_tag = this.content_elem.tagName.toLowerCase();\n      if( ! rows.length) return;\n      if(ie && ie <= 9 && ! opts.tag) opts.tag = rows[0].match(/<([^>\\s/]*)/)[1].toLowerCase();\n      if(this.content_elem.children.length <= 1) cache.data = this.html(rows[0] + rows[0] + rows[0]);\n      if( ! opts.tag) opts.tag = this.content_elem.children[0].tagName.toLowerCase();\n      this.getRowsHeight(rows);\n    },\n    getRowsHeight: function(rows) {\n      var opts = this.options,\n        prev_item_height = opts.item_height;\n      opts.cluster_height = 0;\n      if( ! rows.length) return;\n      var nodes = this.content_elem.children;\n      var node = nodes[Math.floor(nodes.length / 2)];\n      opts.item_height = node.offsetHeight;\n      // consider table's border-spacing\n      if(opts.tag == 'tr' && getStyle('borderCollapse', this.content_elem) != 'collapse')\n        opts.item_height += parseInt(getStyle('borderSpacing', this.content_elem), 10) || 0;\n      // consider margins (and margins collapsing)\n      if(opts.tag != 'tr') {\n        var marginTop = parseInt(getStyle('marginTop', node), 10) || 0;\n        var marginBottom = parseInt(getStyle('marginBottom', node), 10) || 0;\n        opts.item_height += Math.max(marginTop, marginBottom);\n      }\n      opts.block_height = opts.item_height * opts.rows_in_block;\n      opts.rows_in_cluster = opts.blocks_in_cluster * opts.rows_in_block;\n      opts.cluster_height = opts.blocks_in_cluster * opts.block_height;\n      return prev_item_height != opts.item_height;\n    },\n    // get current cluster number\n    getClusterNum: function () {\n      this.options.scroll_top = this.scroll_elem.scrollTop;\n      return Math.floor(this.options.scroll_top / (this.options.cluster_height - this.options.block_height)) || 0;\n    },\n    // generate empty row if no data provided\n    generateEmptyRow: function() {\n      var opts = this.options;\n      if( ! opts.tag || ! opts.show_no_data_row) return [];\n      var empty_row = document.createElement(opts.tag),\n        no_data_content = document.createTextNode(opts.no_data_text), td;\n      empty_row.className = opts.no_data_class;\n      if(opts.tag == 'tr') {\n        td = document.createElement('td');\n        // fixes #53\n        td.colSpan = 100;\n        td.appendChild(no_data_content);\n      }\n      empty_row.appendChild(td || no_data_content);\n      return [empty_row.outerHTML];\n    },\n    // generate cluster for current scroll position\n    generate: function (rows, cluster_num) {\n      var opts = this.options,\n        rows_len = rows.length;\n      if (rows_len < opts.rows_in_block) {\n        return {\n          top_offset: 0,\n          bottom_offset: 0,\n          rows_above: 0,\n          rows: rows_len ? rows : this.generateEmptyRow()\n        }\n      }\n      var items_start = Math.max((opts.rows_in_cluster - opts.rows_in_block) * cluster_num, 0),\n        items_end = items_start + opts.rows_in_cluster,\n        top_offset = Math.max(items_start * opts.item_height, 0),\n        bottom_offset = Math.max((rows_len - items_end) * opts.item_height, 0),\n        this_cluster_rows = [],\n        rows_above = items_start;\n      if(top_offset < 1) {\n        rows_above++;\n      }\n      for (var i = items_start; i < items_end; i++) {\n        rows[i] && this_cluster_rows.push(rows[i]);\n      }\n      return {\n        top_offset: top_offset,\n        bottom_offset: bottom_offset,\n        rows_above: rows_above,\n        rows: this_cluster_rows\n      }\n    },\n    renderExtraTag: function(class_name, height) {\n      var tag = document.createElement(this.options.tag),\n        clusterize_prefix = 'clusterize-';\n      tag.className = [clusterize_prefix + 'extra-row', clusterize_prefix + class_name].join(' ');\n      height && (tag.style.height = height + 'px');\n      return tag.outerHTML;\n    },\n    // if necessary verify data changed and insert to DOM\n    insertToDOM: function(rows, cache) {\n      // explore row's height\n      if( ! this.options.cluster_height) {\n        this.exploreEnvironment(rows, cache);\n      }\n      var data = this.generate(rows, this.getClusterNum()),\n        this_cluster_rows = data.rows.join(''),\n        this_cluster_content_changed = this.checkChanges('data', this_cluster_rows, cache),\n        top_offset_changed = this.checkChanges('top', data.top_offset, cache),\n        only_bottom_offset_changed = this.checkChanges('bottom', data.bottom_offset, cache),\n        callbacks = this.options.callbacks,\n        layout = [];\n\n      if(this_cluster_content_changed || top_offset_changed) {\n        if(data.top_offset) {\n          this.options.keep_parity && layout.push(this.renderExtraTag('keep-parity'));\n          layout.push(this.renderExtraTag('top-space', data.top_offset));\n        }\n        layout.push(this_cluster_rows);\n        data.bottom_offset && layout.push(this.renderExtraTag('bottom-space', data.bottom_offset));\n        callbacks.clusterWillChange && callbacks.clusterWillChange();\n        this.html(layout.join(''));\n        this.options.content_tag == 'ol' && this.content_elem.setAttribute('start', data.rows_above);\n        callbacks.clusterChanged && callbacks.clusterChanged();\n      } else if(only_bottom_offset_changed) {\n        this.content_elem.lastChild.style.height = data.bottom_offset + 'px';\n      }\n    },\n    // unfortunately ie <= 9 does not allow to use innerHTML for table elements, so make a workaround\n    html: function(data) {\n      var content_elem = this.content_elem;\n      if(ie && ie <= 9 && this.options.tag == 'tr') {\n        var div = document.createElement('div'), last;\n        div.innerHTML = '<table><tbody>' + data + '</tbody></table>';\n        while((last = content_elem.lastChild)) {\n          content_elem.removeChild(last);\n        }\n        var rows_nodes = this.getChildNodes(div.firstChild.firstChild);\n        while (rows_nodes.length) {\n          content_elem.appendChild(rows_nodes.shift());\n        }\n      } else {\n        content_elem.innerHTML = data;\n      }\n    },\n    getChildNodes: function(tag) {\n        var child_nodes = tag.children, nodes = [];\n        for (var i = 0, ii = child_nodes.length; i < ii; i++) {\n            nodes.push(child_nodes[i]);\n        }\n        return nodes;\n    },\n    checkChanges: function(type, value, cache) {\n      var changed = value != cache[type];\n      cache[type] = value;\n      return changed;\n    }\n  }\n\n  // support functions\n  function on(evt, element, fnc) {\n    return element.addEventListener ? element.addEventListener(evt, fnc, false) : element.attachEvent(\"on\" + evt, fnc);\n  }\n  function off(evt, element, fnc) {\n    return element.removeEventListener ? element.removeEventListener(evt, fnc, false) : element.detachEvent(\"on\" + evt, fnc);\n  }\n  function isArray(arr) {\n    return Object.prototype.toString.call(arr) === '[object Array]';\n  }\n  function getStyle(prop, elem) {\n    return window.getComputedStyle ? window.getComputedStyle(elem)[prop] : elem.currentStyle[prop];\n  }\n\n  return Clusterize;\n}));","let zoomingOnSingle = false;\r\nconst buildList = (clusterize, listArray, markers, localMap, domElement) => {\r\n\r\n\tif( zoomingOnSingle ){\r\n\t\treturn;\r\n\t}\r\n\r\n\tlistArray = [];\r\n\tclusterize.clear();\r\n\r\n\tmarkers.map((user) => {\r\n\t\tif (localMap.getBounds().contains(user.getPosition())) {\r\n\t\t\tlistArray.push(\r\n\t\t\t`<div class=\"shiftmap-clusterize-user-row shiftmap-clusterize-user-row-${user.userID}\">\r\n\t\t\t\t<div class=\"shiftmap-clusterize-user-cell\">\r\n\t\t\t\t\t<div class=\"shiftmap-clusterize-avatar\">\r\n\t\t\t\t\t\t<div style=\"background-image:url('${user.url}')\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"shiftmap-clusterize-content\">\r\n\t\t\t\t\t\t<h3 class=\"shiftmap-clusterize-user-name\">${user.userName}</h3>\r\n\t\t\t\t\t\t<div class=\"active\">Last active 2 weeks ago</div>\r\n\t\t\t\t\t\t<button class=\"shiftmap-clusterize-user-button\" data-clickuser=\"${user.userID}\">Follow</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>`\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Dsiplay user info on sidebar \r\n\t\tconst showUserInfo = () => {\r\n\t\t\t$(domElement).trigger('openpanel');\r\n\t\t\tclusterize.clear();\r\n\t\t\tclusterize.update([\r\n\t\t\t\t`\r\n\t\t\t\t<div class=\"shiftmap-clusterize-user-row shiftmap-clusterize-user-row-single\">\r\n\t\t\t\t\t<div class=\"shiftmap-clusterize-user-cell\">\r\n\t\t\t\t\t\t<div class=\"shiftmap-clusterize-avatar\">\r\n\t\t\t\t\t\t\t<div style=\"background-image:url('${user.url}')\"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"shiftmap-clusterize-content\">\r\n\t\t\t\t\t\t\t <div class=\"visible\"><span data-clickuser=\"${user.userID}\">User:</span> ${user.userName}</div>\r\n\t\t\t\t\t\t\t <div class=\"${user.city && 'visible'}\"><span>City:</span> ${user.city}</div>\r\n\t\t\t\t\t\t\t <div class=\"${user.country && 'visible'}\"><span>Country:</span> ${user.country}</div>\r\n\t\t\t\t\t\t\t <div class=\"${(user.active||true) && 'visible active'}\">Last active 2 weeks ago</div>\r\n\t\t\t\t\t\t\t <div class=\"visible\">\r\n\t\t\t\t\t\t\t \t<button class=\"shiftmap-clusterize-user-button\" data-clickuser=\"${user.userID}\">Follow</button>\r\n\t\t\t\t\t\t\t </div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t`\r\n\t\t\t]);\r\n\t\t\tclusterize.refresh();\r\n\t\t};\r\n\t\t\r\n\t\t// On marker clikc user info is displayed\r\n\t\tif( !user.clickEventBound ){\r\n\t\t\tgoogle.maps.event.addDomListener(user, 'click', () => {\r\n\t\t\t\tzoomingOnSingle = true;\r\n\t\t\t\tshowUserInfo();\r\n\r\n\t\t\t\tif(localMap.getZoom() < 8 ){\r\n\t\t\t\t\tlocalMap.setZoom(8);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlocalMap.setCenter(user.getPosition());\r\n\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tzoomingOnSingle = false;\r\n\t\t\t\t}, 1000 );\r\n\r\n\t\t\t});\r\n\t\t\tuser.clickEventBound = true;\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tclusterize.update(listArray);\r\n\tclusterize.refresh();\r\n};\r\nexport default buildList;","const checkData = (dataset) => {\r\n\ttry {\r\n\t\tJSON.stringify(dataset);\r\n\t\treturn true;\r\n\t}\r\n\tcatch(err) {\r\n\t\tconsole.error('Data is not JSON format!');\r\n\t\treturn false;\r\n\t}\r\n};\r\nexport default checkData;","// Generate random numbers between a min and a max values\r\nconst getRandom = (min, max) => {\r\n\treturn Math.random() * (max - min) + min;\r\n};\r\n\r\nexport default getRandom;","const pngsList = {\r\n\t'person-001' : [40,63],\r\n\t'person-002' : [38,63],\r\n\t'person-003' : [45,43],\r\n\t'person-004' : [40,62],\r\n\t'person-005' : [39,63],\r\n\t'person-006' : [41,63],\r\n\t'person-007' : [38,63],\r\n\t'person-008' : [40,63],\r\n\t'person-009' : [37,62],\r\n\t'person-010' : [37,62],\r\n\t'person-011' : [38,63],\r\n\t'person-012' : [37,61],\r\n\t'person-013' : [36,63],\r\n\t'person-014' : [37,63],\r\n\t'person-015' : [39,62],\r\n\t'person-016' : [38,62],\r\n\t'person-017' : [37,61],\r\n\t'person-018' : [37,63],\r\n\t'person-019' : [36,61],\r\n\t'person-020' : [39,61],\r\n\t'person-021' : [37,61],\r\n\t'person-022' : [37,60],\r\n\t'person-023' : [41,68],\r\n\t'person-024' : [40,61],\r\n\t'person-025' : [36,61],\r\n\t'person-026' : [38,61],\r\n\t'person-027' : [38,60],\r\n\t'person-028' : [36,60],\r\n\t'person-029' : [37,65],\r\n\t'person-030' : [35,61],\r\n\t'person-031' : [37,63],\r\n\t'person-032' : [44,53],\r\n\t'person-033' : [39,63],\r\n\t'person-034' : [39,63],\r\n\t'person-035' : [68,65],\r\n\t'person-036' : [37,60],\r\n\t'person-037' : [37,60],\r\n\t'person-038' : [37,60],\r\n\t'person-039' : [36,61],\r\n\t'person-040' : [57,62],\r\n\t'person-041' : [65,63],\r\n\t'person-042' : [40,63],\r\n\t'person-043' : [40,63],\r\n\t'person-044' : [49,66],\r\n\t'person-045' : [37,65]\r\n}\r\n\r\nexport default pngsList;\r\n","import Clusterize from 'clusterize.js';\r\nimport { getClusterOptions } from '../map/options';\r\nimport buildList from '../buildList/buildList';\r\nimport checkData from './checkData';\r\nimport getRandom from './getRandom';\r\nimport MarkerClusterer from '../map/markerclusterer.js';\r\nimport pngsList from '../characters/iconsList';\r\n\r\n\r\nconst $ = jQuery;\r\nlet mapDragging = false;\r\n\r\nconst fetchData = (map, data, markers, url, domElement, assetsPath) => {\r\n\r\n\tconst clusterOptions  = getClusterOptions();\r\n\r\n\tlet localMap = map;\r\n\tlet listArray = [];\r\n\tlet avatarURL = url;\r\n\tlet j = 0;\r\n\r\n\tconst pngs = Object.keys(pngsList);\r\n\tconst maxZoomLevel = 13; \r\n\tconst scrollElement = $(domElement).find(\".shiftmap-map-clusterise-wrapper\").get(0);\r\n\tconst contentElement = $(domElement).find(\".shiftmap-clusterize-content-wrapper\").get(0);\r\n\r\n\t// Create list\r\n\tlet clusterize = new Clusterize({\r\n\t\trows: null,\r\n\t\trows_in_block: 2,\r\n\t\tscrollElem: scrollElement,\r\n\t\tcontentElem: contentElement,\r\n\t\tno_data_text: 'No users within range'\r\n\t});\r\n\r\n\t// Add markers\r\n\tif (checkData(data)) {\r\n\t\tdata.map((markerPosition) => {\r\n\t\t\tif (!markerPosition.latitude || !markerPosition.longitude) {\r\n\t\t\t\tconsole.warn('Could not find coordinates on data provided from userID: ', markerPosition.user_id);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (j === pngs.length) {j = 0};\r\n\r\n\t\t\t\tconst randKey = Math.floor((Math.random()*1000)/10 * (pngs.length/100));\r\n\t\t\t\tconst img = pngs[randKey]||pngs[0];\r\n\t\t\t\tconst imgSize = pngsList[img];\r\n\r\n\t\t\t\tlet icon = {\r\n\t\t\t\t\turl: `${assetsPath}${img}.png`,\r\n\t\t\t\t\tsize: new google.maps.Size(imgSize[0], imgSize[1]),\r\n\t\t\t\t\torigin: new google.maps.Point(0, 0),\r\n\t\t\t\t\tanchor: new google.maps.Point(17, 34),\r\n\t\t\t\t\tscaledSize: new google.maps.Size(imgSize[0], imgSize[1]),\r\n\t\t\t\t};\r\n\r\n\t\t\t\tlet location = new google.maps.LatLng({\r\n\t\t\t\t\tlat: markerPosition.latitude + getRandom(0, 0.5), \r\n\t\t\t\t\tlng: markerPosition.longitude + getRandom(0, 0.5)\r\n\t\t\t\t});\r\n\r\n\t\t\t\tconst marker = new google.maps.Marker({\r\n\t\t\t\t\tposition: location,\r\n\t\t\t\t\tmap: localMap,\r\n\t\t\t\t\ticon: icon,\r\n\t\t\t\t\toptimized: false,\r\n\t\t\t\t\tzindex: 0,\r\n\t\t\t\t\tuserID: markerPosition.user_id,\r\n\t\t\t\t\tuserName: markerPosition.full_name,\r\n\t\t\t\t\tcountry: markerPosition.country,\r\n\t\t\t\t\tcity: markerPosition.city,\r\n\t\t\t\t\turl: markerPosition.avatar || './img/person-example.png',\r\n\t\t\t\t});\r\n\t\t\t\tmarkers.push(marker);\r\n\t\t\t\tj++;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Create MarkerClusterer\r\n\t\tconst markerCluster = new MarkerClusterer(localMap, markers, clusterOptions);\r\n\r\n\t\t// Updates list when viewport changes\r\n\t\tgoogle.maps.event.addListener(localMap, 'bounds_changed', function() {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tbuildList(clusterize, listArray, markers, localMap, domElement);\r\n\t\t\t}, 200 );\r\n\t\t});\r\n\r\n\t\tgoogle.maps.event.addListener(map, \"idle\", function() {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tgoogle.maps.event.trigger(map, 'resize');\r\n\t\t\t}, 200 );\r\n\t\t});\r\n\r\n\t\tgoogle.maps.event.addListener(map, \"drag\", () => {\r\n\t\t\tmapDragging = true;\r\n\t\t});\r\n\r\n\t\tgoogle.maps.event.addListener(map, \"dragend\", () => {\r\n\t\t\tsetTimeout(() => mapDragging = false, 50 );\r\n\t\t});\r\n\r\n\t\t// Limit the zoom level\r\n\t\tgoogle.maps.event.addListener(map, 'zoom_changed', function() {\r\n\t\t\tif (map.getZoom() > maxZoomLevel) map.setZoom(maxZoomLevel);\r\n\t\t});\r\n\r\n\t\tbindListeners( map, markerCluster );\r\n\t}\r\n};\r\n\r\nexport default fetchData;\r\n\r\nconst bindListeners = ( map, markerCluster ) => {\r\n\tgoogle.maps.event.addListener(markerCluster, \"clusterclick\", (cluster) => {\r\n\t\t// Stops event propagation\r\n\t\t// Ugly but can't find event.preventDefault\r\n\t\tif(mapDragging){\t\r\n\t\t\tthrow \"Cannot click while dragging\"\r\n\t\t}\r\n\t});\r\n}\r\n\r\n","import { getMapOptions } from './options';\r\nimport template from '../../template.html';\r\n\r\nconst createMap = (domElement) => {\r\n\tconst $ = window.jQuery;\r\n\tconst $wrapper = $(domElement).html(template);\r\n\tconst $map = $wrapper.find('.shiftmap-map');\r\n\tconst opt = getMapOptions();\r\n\treturn new google.maps.Map($map.get(0), opt);\t\r\n}\r\n\r\nexport default createMap;\r\n","(function (root) {\n\n  // Store setTimeout reference so promise-polyfill will be unaffected by\n  // other code modifying setTimeout (like sinon.useFakeTimers())\n  var setTimeoutFunc = setTimeout;\n\n  function noop() {}\n  \n  // Polyfill for Function.prototype.bind\n  function bind(fn, thisArg) {\n    return function () {\n      fn.apply(thisArg, arguments);\n    };\n  }\n\n  function Promise(fn) {\n    if (typeof this !== 'object') throw new TypeError('Promises must be constructed via new');\n    if (typeof fn !== 'function') throw new TypeError('not a function');\n    this._state = 0;\n    this._handled = false;\n    this._value = undefined;\n    this._deferreds = [];\n\n    doResolve(fn, this);\n  }\n\n  function handle(self, deferred) {\n    while (self._state === 3) {\n      self = self._value;\n    }\n    if (self._state === 0) {\n      self._deferreds.push(deferred);\n      return;\n    }\n    self._handled = true;\n    Promise._immediateFn(function () {\n      var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n      if (cb === null) {\n        (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n        return;\n      }\n      var ret;\n      try {\n        ret = cb(self._value);\n      } catch (e) {\n        reject(deferred.promise, e);\n        return;\n      }\n      resolve(deferred.promise, ret);\n    });\n  }\n\n  function resolve(self, newValue) {\n    try {\n      // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n      if (newValue === self) throw new TypeError('A promise cannot be resolved with itself.');\n      if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n        var then = newValue.then;\n        if (newValue instanceof Promise) {\n          self._state = 3;\n          self._value = newValue;\n          finale(self);\n          return;\n        } else if (typeof then === 'function') {\n          doResolve(bind(then, newValue), self);\n          return;\n        }\n      }\n      self._state = 1;\n      self._value = newValue;\n      finale(self);\n    } catch (e) {\n      reject(self, e);\n    }\n  }\n\n  function reject(self, newValue) {\n    self._state = 2;\n    self._value = newValue;\n    finale(self);\n  }\n\n  function finale(self) {\n    if (self._state === 2 && self._deferreds.length === 0) {\n      Promise._immediateFn(function() {\n        if (!self._handled) {\n          Promise._unhandledRejectionFn(self._value);\n        }\n      });\n    }\n\n    for (var i = 0, len = self._deferreds.length; i < len; i++) {\n      handle(self, self._deferreds[i]);\n    }\n    self._deferreds = null;\n  }\n\n  function Handler(onFulfilled, onRejected, promise) {\n    this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n    this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n    this.promise = promise;\n  }\n\n  /**\n   * Take a potentially misbehaving resolver function and make sure\n   * onFulfilled and onRejected are only called once.\n   *\n   * Makes no guarantees about asynchrony.\n   */\n  function doResolve(fn, self) {\n    var done = false;\n    try {\n      fn(function (value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      }, function (reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      });\n    } catch (ex) {\n      if (done) return;\n      done = true;\n      reject(self, ex);\n    }\n  }\n\n  Promise.prototype['catch'] = function (onRejected) {\n    return this.then(null, onRejected);\n  };\n\n  Promise.prototype.then = function (onFulfilled, onRejected) {\n    var prom = new (this.constructor)(noop);\n\n    handle(this, new Handler(onFulfilled, onRejected, prom));\n    return prom;\n  };\n\n  Promise.all = function (arr) {\n    var args = Array.prototype.slice.call(arr);\n\n    return new Promise(function (resolve, reject) {\n      if (args.length === 0) return resolve([]);\n      var remaining = args.length;\n\n      function res(i, val) {\n        try {\n          if (val && (typeof val === 'object' || typeof val === 'function')) {\n            var then = val.then;\n            if (typeof then === 'function') {\n              then.call(val, function (val) {\n                res(i, val);\n              }, reject);\n              return;\n            }\n          }\n          args[i] = val;\n          if (--remaining === 0) {\n            resolve(args);\n          }\n        } catch (ex) {\n          reject(ex);\n        }\n      }\n\n      for (var i = 0; i < args.length; i++) {\n        res(i, args[i]);\n      }\n    });\n  };\n\n  Promise.resolve = function (value) {\n    if (value && typeof value === 'object' && value.constructor === Promise) {\n      return value;\n    }\n\n    return new Promise(function (resolve) {\n      resolve(value);\n    });\n  };\n\n  Promise.reject = function (value) {\n    return new Promise(function (resolve, reject) {\n      reject(value);\n    });\n  };\n\n  Promise.race = function (values) {\n    return new Promise(function (resolve, reject) {\n      for (var i = 0, len = values.length; i < len; i++) {\n        values[i].then(resolve, reject);\n      }\n    });\n  };\n\n  // Use polyfill for setImmediate for performance gains\n  Promise._immediateFn = (typeof setImmediate === 'function' && function (fn) { setImmediate(fn); }) ||\n    function (fn) {\n      setTimeoutFunc(fn, 0);\n    };\n\n  Promise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n    if (typeof console !== 'undefined' && console) {\n      console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n    }\n  };\n\n  /**\n   * Set the immediate function to execute callbacks\n   * @param fn {function} Function to execute\n   * @deprecated\n   */\n  Promise._setImmediateFn = function _setImmediateFn(fn) {\n    Promise._immediateFn = fn;\n  };\n\n  /**\n   * Change the function to execute on unhandled rejection\n   * @param {function} fn Function to execute on unhandled rejection\n   * @deprecated\n   */\n  Promise._setUnhandledRejectionFn = function _setUnhandledRejectionFn(fn) {\n    Promise._unhandledRejectionFn = fn;\n  };\n  \n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = Promise;\n  } else if (!root.Promise) {\n    root.Promise = Promise;\n  }\n\n})(this);\n","import Promise from 'promise-polyfill'; \r\n\r\nif (!window.Promise) {\r\n  window.Promise = Promise;\r\n}","(function(self) {\n  'use strict';\n\n  if (self.fetch) {\n    return\n  }\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob: 'FileReader' in self && 'Blob' in self && (function() {\n      try {\n        new Blob()\n        return true\n      } catch(e) {\n        return false\n      }\n    })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  }\n\n  if (support.arrayBuffer) {\n    var viewClasses = [\n      '[object Int8Array]',\n      '[object Uint8Array]',\n      '[object Uint8ClampedArray]',\n      '[object Int16Array]',\n      '[object Uint16Array]',\n      '[object Int32Array]',\n      '[object Uint32Array]',\n      '[object Float32Array]',\n      '[object Float64Array]'\n    ]\n\n    var isDataView = function(obj) {\n      return obj && DataView.prototype.isPrototypeOf(obj)\n    }\n\n    var isArrayBufferView = ArrayBuffer.isView || function(obj) {\n      return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n    }\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name)\n    }\n    if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value)\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift()\n        return {done: value === undefined, value: value}\n      }\n    }\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      }\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {}\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value)\n      }, this)\n    } else if (Array.isArray(headers)) {\n      headers.forEach(function(header) {\n        this.append(header[0], header[1])\n      }, this)\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name])\n      }, this)\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name)\n    value = normalizeValue(value)\n    var oldValue = this.map[name]\n    this.map[name] = oldValue ? oldValue+','+value : value\n  }\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)]\n  }\n\n  Headers.prototype.get = function(name) {\n    name = normalizeName(name)\n    return this.has(name) ? this.map[name] : null\n  }\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  }\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = normalizeValue(value)\n  }\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    for (var name in this.map) {\n      if (this.map.hasOwnProperty(name)) {\n        callback.call(thisArg, this.map[name], name, this)\n      }\n    }\n  }\n\n  Headers.prototype.keys = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push(name) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.values = function() {\n    var items = []\n    this.forEach(function(value) { items.push(value) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.entries = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push([name, value]) })\n    return iteratorFor(items)\n  }\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result)\n      }\n      reader.onerror = function() {\n        reject(reader.error)\n      }\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsArrayBuffer(blob)\n    return promise\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsText(blob)\n    return promise\n  }\n\n  function readArrayBufferAsText(buf) {\n    var view = new Uint8Array(buf)\n    var chars = new Array(view.length)\n\n    for (var i = 0; i < view.length; i++) {\n      chars[i] = String.fromCharCode(view[i])\n    }\n    return chars.join('')\n  }\n\n  function bufferClone(buf) {\n    if (buf.slice) {\n      return buf.slice(0)\n    } else {\n      var view = new Uint8Array(buf.byteLength)\n      view.set(new Uint8Array(buf))\n      return view.buffer\n    }\n  }\n\n  function Body() {\n    this.bodyUsed = false\n\n    this._initBody = function(body) {\n      this._bodyInit = body\n      if (!body) {\n        this._bodyText = ''\n      } else if (typeof body === 'string') {\n        this._bodyText = body\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString()\n      } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n        this._bodyArrayBuffer = bufferClone(body.buffer)\n        // IE 10-11 can't handle a DataView body.\n        this._bodyInit = new Blob([this._bodyArrayBuffer])\n      } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n        this._bodyArrayBuffer = bufferClone(body)\n      } else {\n        throw new Error('unsupported BodyInit type')\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8')\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type)\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n        }\n      }\n    }\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyArrayBuffer) {\n          return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      }\n\n      this.arrayBuffer = function() {\n        if (this._bodyArrayBuffer) {\n          return consumed(this) || Promise.resolve(this._bodyArrayBuffer)\n        } else {\n          return this.blob().then(readBlobAsArrayBuffer)\n        }\n      }\n    }\n\n    this.text = function() {\n      var rejected = consumed(this)\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return readBlobAsText(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as text')\n      } else {\n        return Promise.resolve(this._bodyText)\n      }\n    }\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      }\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    }\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase()\n    return (methods.indexOf(upcased) > -1) ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {}\n    var body = options.body\n\n    if (input instanceof Request) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url\n      this.credentials = input.credentials\n      if (!options.headers) {\n        this.headers = new Headers(input.headers)\n      }\n      this.method = input.method\n      this.mode = input.mode\n      if (!body && input._bodyInit != null) {\n        body = input._bodyInit\n        input.bodyUsed = true\n      }\n    } else {\n      this.url = String(input)\n    }\n\n    this.credentials = options.credentials || this.credentials || 'omit'\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers)\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET')\n    this.mode = options.mode || this.mode || null\n    this.referrer = null\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body)\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this, { body: this._bodyInit })\n  }\n\n  function decode(body) {\n    var form = new FormData()\n    body.trim().split('&').forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n    return form\n  }\n\n  function parseHeaders(rawHeaders) {\n    var headers = new Headers()\n    rawHeaders.split(/\\r?\\n/).forEach(function(line) {\n      var parts = line.split(':')\n      var key = parts.shift().trim()\n      if (key) {\n        var value = parts.join(':').trim()\n        headers.append(key, value)\n      }\n    })\n    return headers\n  }\n\n  Body.call(Request.prototype)\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {}\n    }\n\n    this.type = 'default'\n    this.status = 'status' in options ? options.status : 200\n    this.ok = this.status >= 200 && this.status < 300\n    this.statusText = 'statusText' in options ? options.statusText : 'OK'\n    this.headers = new Headers(options.headers)\n    this.url = options.url || ''\n    this._initBody(bodyInit)\n  }\n\n  Body.call(Response.prototype)\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  }\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''})\n    response.type = 'error'\n    return response\n  }\n\n  var redirectStatuses = [301, 302, 303, 307, 308]\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  }\n\n  self.Headers = Headers\n  self.Request = Request\n  self.Response = Response\n\n  self.fetch = function(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request = new Request(input, init)\n      var xhr = new XMLHttpRequest()\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n        }\n        options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL')\n        var body = 'response' in xhr ? xhr.response : xhr.responseText\n        resolve(new Response(body, options))\n      }\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.open(request.method, request.url, true)\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob'\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n    })\n  }\n  self.fetch.polyfill = true\n})(typeof self !== 'undefined' ? self : this);\n","import '../../polyfills/promise';\r\nimport 'whatwg-fetch';\r\nimport pngsList from './iconsList';\r\n\r\n\r\nconst placeCharacters = (map, assetsPath) => {\r\n\r\n\t// DISABLED for now\r\n\treturn true;\r\n\r\n\tconst airportsMarkers = [];\r\n\tconst icons = [];\r\n\tconst localMap = map;\r\n\tconst pngs = Object.keys(pngsList);\r\n\tlet j = 0;\r\n\t\r\n\r\n\tfetch(\"./datasets/airports.json\")\r\n\t\t.then((response) => response.json())\r\n\t\t.then((airports) => {\t\t\t\t\t\r\n\t\t\tairports.map((airport) => {\r\n\t\t\t\tif (j === pngs.length) {j = 0};\r\n\t\t\t\tconst randKey = Math.floor((Math.random()*1000)/10 * (pngs.length/100));\r\n\t\t\t\tconst img = pngs[randKey]||pngs[0];\r\n\t\t\t\tconst imgSize = pngsList[img];\r\n\r\n\t\t\t\t// Character object \r\n\t\t\t\tlet character = {\r\n\t\t\t\t\tposition: new google.maps.LatLng(airport.latitude, airport.longitude),\r\n\t\t\t\t\ticon: {\r\n\t\t\t\t\t\turl: `${assetsPath}${img}.png`,\r\n\t\t\t\t\t\tsize: new google.maps.Size(imgSize[0], imgSize[1]),\r\n\t\t\t\t\t\torigin: new google.maps.Point(0, 0),\r\n\t\t\t\t\t\tanchor: new google.maps.Point(17, 34),\r\n\t\t\t\t\t\tscaledSize: new google.maps.Size(imgSize[0], imgSize[1]),\r\n\t\t\t\t\t},\r\n\t\t\t\t}\r\n\t\t\t\t// Add a marker for each character\r\n\t\t\t\tairportsMarkers.push(\tnew google.maps.Marker({\r\n\t\t\t\t\t\tposition: character.position,\r\n\t\t\t\t\t\tmap: localMap,\r\n\t\t\t\t\t\ticon: character.icon,\r\n\t\t\t\t\t\tvisible: false\r\n\t\t\t\t\t})\r\n\t\t\t\t);\t\t\t\r\n\t\t\t\ticons.push(character);\r\n\t\t\t\tj++;\r\n\t\t\t});\r\n\r\n\t\t\t// Shuffle the markers\r\n\t\t\tshuffle( airportsMarkers );\r\n\r\n\t\t\t// Initial visibility\r\n\t\t\tsetVisibleMarkers(localMap.getZoom());\r\n\r\n\t\t}).catch((err) => {\r\n\t\t\tconsole.log(err);\r\n\t});\r\n\r\n\t//\tChange markers on zoom\r\n\tgoogle.maps.event.addListener(localMap, 'zoom_changed', function() {\r\n\t\tsetVisibleMarkers(localMap.getZoom());\r\n\t\tlet zoom = localMap.getZoom();\r\n\t});\r\n\r\n\tfunction setVisibleMarkers( zoom ){\r\n\t\tconst maxZoom = 8;\r\n\t\tconst max = airportsMarkers.length * (zoom/maxZoom/20);\r\n\t\tlet y = 0;\r\n\t\tairportsMarkers.map((marker, i) => {\r\n\t\t\tmarker.setVisible(i < max);\r\n\t\t\ti < max && (y++);\r\n\t\t});\r\n\t\tconsole.log(`${y} markers display at ${zoom} with max at ${max}`);\r\n\t}\r\n}\r\n\r\nexport default placeCharacters;\r\n\r\n/**\r\n * Shuffles array in place. ES6 version\r\n * @param {Array} a items The array containing the items.\r\n */\r\nfunction shuffle(a) {\r\n    for (let i = a.length; i; i--) {\r\n        let j = Math.floor(Math.random() * i);\r\n        [a[i - 1], a[j]] = [a[j], a[i - 1]];\r\n    }\r\n}\r\n","const checkAssetsPath = (assetsPath) => {\r\n\t \r\n\tif (RegExp('^(/[^/ ]*)+/$').test(assetsPath)) {\r\n\t\treturn true;\r\n\t}\r\n\telse {\r\n\t\tconsole.error('Please provide the icons directory as in \"/path/to/icons/\"')\r\n\t}\r\n};\r\nexport default checkAssetsPath;","/*eslint-disable */\r\nimport '../../../styles/main.v2.scss';\r\n\r\nimport createSearchBox from '../searchBox/createSearchBox';\r\nimport searchBox from '../searchBox/searchBox';\r\nimport promoAreaLogged from '../promoArea/promoAreaLogged';\r\nimport promoArea from '../promoArea/promoArea';\r\nimport fetchData from '../fetchData/fetchData';\r\nimport createMap from './createMap';\r\nimport defineCenter from './defineCenter';\r\nimport placeCharacters from '../characters/placeCharacters';\r\nimport checkAssetsPath from '../characters/checkAssetsPath';\r\nimport mapStyles, {mapDetailStyles} from './mapStyles';\r\n\r\n\r\nimport {\r\n\tgetIcon,\r\n\tsetIcon,\r\n\taddCenterToOptions\r\n} from './options';\r\n\r\nconst $ = window.jQuery;\r\n\r\nif(!$){\r\n\tthrow 'jQuery is required for this map plugin';\r\n}\r\n\r\nclass Map {\r\n\tconstructor( settings ){\r\n\t\t$.extend(this, settings);\r\n\t\tthis.markers = this.markers || [];\r\n\t\tthis.placeMarkers = this.placeMarkers || [];\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tinit(){\r\n\t\tthis.listeners = [];\r\n\t\tthis.wrapper = this.domElement;\r\n\t\tthis.map = createMap(this.wrapper);\r\n\t\tthis.sBox = createSearchBox(this.map, this.domElement);\r\n\t\tthis.avatarURL = this.avatarURL || defineURL('https://github.com/identicons/', '.png');\r\n\r\n\t\tpanelClosedOnLoad(this.domElement);\r\n\t\tbindEvents( this.domElement, this.map );\r\n\t\tbindClickEvent( this.domElement, this.data, this.listeners );\r\n\r\n\t\t// Other initiliasation\r\n\t\tthis.initFetchData();\r\n\t\tthis.initSearchBox();\r\n\t\tthis.initPromoAreas();\r\n\t\tthis.placeCharacters();\r\n\t\tthis.initMapFullDisplay();\r\n\t\tthis.initMapGenericBehaviour();\r\n\t}\r\n\r\n\tinitFetchData(){\r\n\t\tfetchData(\r\n\t\t\tthis.map, \r\n\t\t\tthis.data, \r\n\t\t\tthis.markers, \r\n\t\t\tthis.avatarURL, \r\n\t\t\tthis.domElement,\r\n\t\t\tthis.assetsPath\r\n\t\t);\r\n\t}\r\n\r\n\tinitSearchBox(){\r\n\t\tsearchBox(\r\n\t\t\tthis.map, \r\n\t\t\tthis.places, \r\n\t\t\tthis.sBox, \r\n\t\t\tthis.placeMarkers, \r\n\t\t\tthis.getIcon, \r\n\t\t\tthis.setIcon\r\n\t\t);\r\n\t}\r\n\r\n\tinitPromoAreas(){\r\n\t\t// Render promo area\r\n\t\tif(this.isLoggedIn){\r\n\t\t\tpromoAreaLogged(() => {\r\n\t\t\t\tconsole.log('change your location clicked')\r\n\t\t\t}, this.assetsPath)\r\n\t\t} else {\r\n\t\t\tpromoArea(() => {\r\n\t\t\t\tconsole.log('Add your marker clicked!')\r\n\t\t\t}, this.markers.length, this.assetsPath)\r\n\t\t}\r\n\r\n\t\t// Display air balloon\r\n\t\tairBalloon(this.domElement, this.isLoggedIn, this.assetsPath);\r\n\t}\r\n\r\n\tplaceCharacters(){\r\n\t\t// Add characters\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (checkAssetsPath(this.assetsPath)) {\r\n\t\t\t\tplaceCharacters(this.map, this.assetsPath);\r\n\t\t\t}\r\n\t\t}, 100 );\r\n\t}\r\n\r\n\tinitMapFullDisplay(){\r\n\t\t// Show whole map on click\r\n\t\tshowMap(this.domElement, this.map);\r\n\t}\r\n\r\n\tinitMapGenericBehaviour(){\r\n\t\t// Open panel on zoom\r\n\t\tgoogle.maps.event.addListenerOnce(this.map, 'zoom_changed', function () {\r\n\t\t\tconst $panel = $(this.domElement).find('.shiftmap-map-clusterise-user-panel');\r\n\t\t\t$panel.removeClass('default')\r\n\t\t});\r\n\t}\r\n\r\n\t// Returns an object of public events\r\n\t// Used for manipulating the map after load\r\n\t// Or listening to events\r\n\tpublic(){\r\n\t\tconst self = this;\r\n\r\n\t\treturn {\r\n\t\t\tenablePlotLocationMode: () => {\r\n\t\t\t\tenablePlotLocationMode(this.domElement);\r\n\t\t\t},\r\n\t\t\tsetWidthHeight: ( width, height ) => {\r\n\t\t\t\tsetWidthHeight( width, height, this.map );\r\n\t\t\t},\r\n\t\t\tsetMapLocation: ( lat, lng ) => {\r\n\t\t\t\tchangeMapLocation( lat, lng, this.map );\r\n\t\t\t},\r\n\t\t\tonMapReady : ( callback ) => {\r\n\t\t\t\tonMapReady( callback, this.map );\r\n\t\t\t},\r\n\t\t\tonAirBalloonClick: ( callback ) => {\r\n\t\t\t\tonAirBalloonClick(this.domElement, callback);\r\n\t\t\t},\r\n\t\t\tonMapChangeLocation: ( callback ) => {\r\n\t\t\t\tonMapChangeLocation( callback, this.map );\r\n\t\t\t},\r\n\t\t\tonPlotLocation: ( callback ) => {\r\n\t\t\t\tonPlotLocation(this.map, callback );\r\n\t\t\t},\r\n\t\t\tonClickUser : ( callback ) => {\r\n\t\t\t\tonClickUser( callback, null, this.listeners);\r\n\t\t\t},\r\n\t\t\tinsertMarker: ( lat, lng, imgURL, clickEvent) => {\r\n\t\t\t\tinsertMarker(lat, lng, imgURL, clickEvent, this.map);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n}\r\n\r\nconst initialize = (settings) => {\r\n\tconst map = new Map(settings);\r\n\treturn map.public();\r\n};\r\n\r\n\r\n// Plot location listener\r\nconst onPlotLocation = (map, callback) => {\r\n\tgoogle.maps.event.addListener(map, 'shiftms_plotted_location', callback);\r\n};\r\n\r\n\r\n// Air Balloon\r\nconst airBalloon = (domElement, logged, assetsPath) => {\r\n\tlet balloon = $(domElement).find('.shiftmap-airballoon-image');\r\n\tlet dismiss = $(domElement).find('.balloon-dismiss');\r\n\t$(dismiss).click(( e ) => {\r\n\t\t$(balloon).remove();\r\n\t});\r\n\tif (logged) {\r\n\t\tballoon.remove();\r\n\t\t//balloon.attr('src', `${assetsPath}promo/map-hot-air-balloon.png`);\r\n\t}\r\n\telse { balloon.attr('src', `${assetsPath}promo/map-hot-air-balloon.png?v=1`); }\r\n};\r\n\r\n\r\n// Balloon click listener\r\nconst onAirBalloonClick = (domElement, callback) => {\r\n\tconst balloon = $(domElement).find('.shiftmap-airballoon-image');\r\n\tballoon.click( callback );\r\n}\r\n\r\n// Insert markers after map is loaded\r\nconst insertMarker = (lat, lng, imgURL, clickEvent, map) => {\r\n\tlat = lat || null;\r\n\tlng = lng || null;\r\n\timgURL = imgURL.toString() || null;\r\n\tclickEvent = clickEvent || function(){};\r\n\r\n\tif (typeof clickEvent !== 'function') {\r\n\t\tthrow 'Click event must be a function!';\r\n\t}\r\n\r\n\tif (typeof lat !== 'number' || typeof lng !== 'number') {\r\n\t\tthrow 'Coordinates must be numbers!';\r\n\t}\r\n\r\n\tvar img = new Image();\r\n\timg.onload = () => {\r\n\t\tconst imgWidth = Math.abs(img.width/2) || null;\r\n\t\tconst imgHeight = Math.abs(img.height/2) || null;\r\n\r\n\t\tconst location = new google.maps.LatLng(parseFloat(lat).toFixed(6), parseFloat(lng).toFixed(6));\r\n\t\tconst icon = {\r\n\t\t\turl: `${imgURL}`,\r\n\t\t\tsize: new google.maps.Size(imgWidth, imgHeight),\r\n\t\t\torigin: new google.maps.Point(0, 0),\r\n\t\t\tanchor: new google.maps.Point(imgWidth/2, imgHeight),\r\n\t\t\tscaledSize: new google.maps.Size(imgWidth, imgHeight),\r\n\t\t};\r\n\t\tconst marker = new google.maps.Marker({\r\n\t\t\tposition: location,\r\n\t\t\ticon: icon,\r\n\t\t\tmap: map,\r\n\t\t\t// optimized: false,\r\n\t\t\t// zindex: 0,\r\n\t\t\turl: '',\r\n\t\t}).addListener('click', function(){\r\n\t\t\tclickEvent( marker, imgURL );\r\n\t\t});\r\n\r\n\t}\r\n\r\n\timg.src = imgURL;\r\n};\r\n\r\n\r\n// Panel closed on page load\r\nconst panelClosedOnLoad = (domElement) => {\r\n\tconst $panel = $(domElement).find('.shiftmap-map-clusterise-user-panel');\r\n\t\t$panel.toggleClass('default');\r\n};\r\n\r\n\r\n// Move map to specified coordinates , dk why i built this though\r\nconst changeMapLocation = (lat, lng, map) => {\r\n\tlet location = defineCenter(lat, lng);\r\n\tmap.panTo(location);\r\n};\r\n\r\n\r\n// Detects when map is loaded\r\nconst onMapReady = (callback, map) => {\r\n\tif (typeof callback === 'function') {\r\n\t\tgoogle.maps.event.addListenerOnce(map, 'idle', callback);\r\n\t}\r\n\telse {\r\n\t\tconsole.error('provide a callback function');\r\n\t}\r\n};\r\n\r\n\r\n// Fires event when map changes locations\r\nconst onMapChangeLocation = (callback, map) => {\r\n\tif (typeof callback === 'function') {\r\n\t\tgoogle.maps.event.addListener(map, 'idle', callback);\r\n\t}\r\n\telse {\r\n\t\tconsole.error('provide a callback function');\r\n\t}\r\n};\r\n\r\n\r\n// Builds assets URL in acceptable format\r\nconst defineURL = (url, imgFormat) => {\r\n\treturn [url.toString(), imgFormat.toString()];\r\n};\r\n\r\n\r\n// Display zoomed out map \r\nconst showMap = (domElement, map) => {\r\n\tconst showMapButton = $(domElement).find('.shiftmap-showmap');\r\n\tconst topLeft = new google.maps.LatLng(68.870136, -160.789405);\r\n\tconst bottomRight = new google.maps.LatLng(-44.879507, 178.880419)\r\n\tconst bounds = new google.maps.LatLngBounds(topLeft, bottomRight);\r\n\t\r\n\tconst onClick = () => {\r\n\t\tshowMapButton.click(function() {\r\n\t\t\tmap.fitBounds(bounds)\r\n\t\t});\r\n\t}\r\n\tgoogle.maps.event.addListener(map, 'idle', onClick);\r\n};\r\n\r\n\r\nconst bindEvents = ( domElement, map ) => {\r\n\tconst $panel = $(domElement).find('.shiftmap-map-clusterise-user-panel');\r\n\r\n\t$panel.find('.shiftmap-map-toggle-panel').click(function(){\r\n\t\t$(this).removeClass('alert-user');\r\n\t\tif ($panel.hasClass('default')) {\r\n\t\t\t$panel.removeClass('default')\r\n\t\t}\r\n\t\telse {\r\n\t\t\t$panel.toggleClass('closed');\r\n\t\t}\r\n\t});\r\n\r\n\t//\tChange markers on zoom\r\n\tgoogle.maps.event.addListener(map, 'zoom_changed', function() {\r\n\t\tlet zoom = map.getZoom();\r\n\t\tif( zoom > 7 ){\r\n\t\t\tmap.setOptions({styles: mapDetailStyles});\r\n\t\t} else {\t\t\t\r\n\t\t\tmap.setOptions({styles: mapStyles});\r\n\t\t}\r\n\t});\r\n\r\n\t$(domElement).on('openpanel', () => {\r\n\t\t$panel.removeClass('closed');\r\n\t});\r\n\r\n\tgoogle.maps.event.addListenerOnce(map, 'idle', function(){\r\n\t   geolocationAPI(map);\r\n\t});\r\n\r\n};\r\n\r\n\r\n// Define map dimensions\r\nconst setWidthHeight = (width, height, map) => {\r\n\t$('.shiftmap-wrapper').width(width).height(height);\r\n\t$('.shiftmap-map').width(width).height(height);\r\n\tgoogle.maps.event.trigger(map, 'resize');\t\r\n\tgoogle.maps.event.addListenerOnce(map, 'idle', function() {\r\n\t\tgoogle.maps.event.trigger(map, 'resize'); \r\n\t});\r\n};\r\n\r\n\r\nconst onClickUser = (fn, args, listeners ) => {\r\n\tif( fn ){\r\n\t\tlisteners.push(fn);\r\n\t} else {\r\n\t\tlisteners.map((e) => e(args))\r\n\t}\r\n}\r\n\r\n\r\nconst bindClickEvent = ( domElement, data, listeners ) => {\r\n\t$(domElement).on('click', '[data-clickuser]', function(){\r\n\t\tconst id = $(this).data('clickuser');\r\n\t\tlet find;\r\n\t\tdata.map((e) => {\r\n\t\t\tif( e.user_id === id ){\r\n\t\t\t\tfind = e;\r\n\t\t\t}\r\n\t\t});\r\n\t\tlisteners.map((fn) => fn(find));\r\n\t});\r\n}\r\n\r\n\r\nconst geolocationAPI = ( map ) => {\r\n\tif (navigator.geolocation) {\r\n\t\tnavigator.geolocation.getCurrentPosition(function (position) {\r\n\t\t\tconst initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);\r\n\t\t\tmap.setCenter(initialLocation);\r\n\t\t\tmap.setZoom(5);\r\n\t\t});\r\n\t}\r\n};\r\n\r\nconst enablePlotLocationMode = (wrapper) => {\r\n\t$(wrapper).find('.shiftmap-promo-area').addClass('in');\r\n\t$(wrapper).find('.shiftmap-map-clusterise-user-panel').removeClass('default closed');\r\n\t$('html').addClass('map-plotting-active');\r\n}\r\n\r\n\r\nexport {\r\n\tinitialize\r\n};\r\n\r\n/*\r\n\tinsertMarker,\r\n\tsetWidthHeight,\r\n\tonMapReady,\r\n\tonMapChangeLocation,\r\n\tdefineURL,\r\n\tchangeMapLocation,\r\n\tonClickUser,\r\n\tonPlotLocation,\r\n\tonAirBalloonClick,\r\n\tenablePlotLocationMode\r\n*/"],"names":["MarkerClusterer","map","opt_markers","opt_options","extend","google","maps","OverlayView","map_","markers_","clusters_","sizes","styles_","ready_","options","gridSize_","minClusterSize_","maxZoom_","imagePath_","this","MARKER_CLUSTER_IMAGE_PATH_","imageExtension_","MARKER_CLUSTER_IMAGE_EXTENSION_","zoomOnClick_","undefined","averageCenter_","setupStyles_","setMap","prevZoom_","getZoom","that","event","addListener","zoom","minZoom","maxZoom","Math","min","mapTypes","getMapTypeId","max","resetViewport","redraw","length","Object","keys","addMarkers","Cluster","markerClusterer","markerClusterer_","getMap","getGridSize","getMinClusterSize","isAverageCenter","center_","bounds_","clusterIcon_","ClusterIcon","getStyles","cluster","styles","opt_padding","getMarkerClusterer","padding_","cluster_","div_","sums_","visible_","$","window","jQuery","createSearchBox","mapWrapper","$input","find","input","get","places","SearchBox","Symbol","id","width","height","fill","marker_svg","btoa","p","land","mapStyles","mapDetailStyles","defineCenter","lat","lng","LatLng","parseFloat","toFixed","clusterOptions","getMapOptions","MapTypeId","ROADMAP","clusterStyles","getClusterOptions","getIconPlace","Size","Point","searchBox","sBox","placeMarkers","getIcon","setIcon","setBounds","getBounds","isPlotSearch","getPlaces","forEach","marker","bounds","LatLngBounds","place","geometry","log","Marker","name","location","push","viewport","union","fitBounds","addListenerOnce","createInfoWindow","setZoom","html","infowindow","InfoWindow","setContent","click","trigger","close","removeClass","open","promoArea","insertMarker","assetsPath","promoHtml","replace","userPanel","prepend","addClass","one","focus","numUsers","definition","on","evt","element","fnc","addEventListener","attachEvent","off","removeEventListener","detachEvent","isArray","arr","prototype","toString","call","getStyle","prop","elem","getComputedStyle","currentStyle","ie","v","el","document","createElement","all","innerHTML","documentMode","is_mac","navigator","platform","toLowerCase","indexOf","Clusterize","data","self","defaults","option","i","elems","getElementById","Error","content_elem","hasAttribute","setAttribute","rows","fetchMarkup","cache","scroll_top","scroll_elem","scrollTop","insertToDOM","last_cluster","scroll_debounce","pointer_events_set","scrollEv","style","pointerEvents","setTimeout","getClusterNum","callbacks","scrollingProgress","getScrollProgress","resize_debounce","resizeEv","refresh","destroy","clean","generateEmptyRow","join","force","getRowsHeight","update","new_rows","item_height","clear","getRowsAmount","add","where","_new_rows","concat","append","rows_nodes","getChildNodes","shift","outerHTML","opts","content_tag","tagName","tag","match","children","prev_item_height","cluster_height","nodes","node","floor","offsetHeight","parseInt","marginTop","marginBottom","block_height","rows_in_block","rows_in_cluster","blocks_in_cluster","show_no_data_row","td","empty_row","no_data_content","createTextNode","no_data_text","className","no_data_class","colSpan","appendChild","cluster_num","rows_len","items_start","items_end","top_offset","bottom_offset","this_cluster_rows","rows_above","class_name","clusterize_prefix","exploreEnvironment","generate","this_cluster_content_changed","checkChanges","top_offset_changed","only_bottom_offset_changed","layout","keep_parity","renderExtraTag","clusterWillChange","clusterChanged","lastChild","last","div","removeChild","firstChild","child_nodes","ii","type","value","changed","zoomingOnSingle","buildList","clusterize","listArray","markers","localMap","domElement","user","contains","getPosition","userID","url","userName","showUserInfo","city","country","active","clickEventBound","addDomListener","setCenter","checkData","dataset","stringify","err","error","getRandom","random","obj1","obj2","object","property","apply","onAdd","setReady_","draw","size","fitMapToMarkers","getMarkers","setStyles","isZoomOnClick","getTotalMarkers","setMaxZoom","getMaxZoom","calculator_","numStyles","index","count","dv","setCalculator","calculator","getCalculator","opt_nodraw","pushMarkerTo_","isAdded","repaint","addMarker","removeMarker_","m","splice","removeMarker","removed","removeMarkers","markersCopy","slice","r","ready","createClusters_","getTotalClusters","setGridSize","setMinClusterSize","getExtendedBounds","projection","getProjection","tr","getNorthEast","bl","getSouthWest","trPix","fromLatLngToDivPixel","x","y","blPix","ne","fromDivPixelToLatLng","sw","isMarkerInBounds_","clearMarkers","opt_hide","remove","oldClusters","distanceBetweenPoints_","p1","p2","dLat","PI","dLon","a","sin","cos","atan2","sqrt","addToClosestCluster_","distance","clusterToAddTo","center","getCenter","d","isMarkerInClusterBounds","mapBounds","isMarkerAlreadyAdded","l","calculateBounds_","len","updateIcon","getSize","mz","hide","sums","setSums","show","triggerClusterClick","panes","getPanes","pos","getPosFromLatLng_","cssText","createCss","text","overlayMouseTarget","classList","latlng","width_","height_","top","left","display","onRemove","parentNode","text_","index_","useStyle","url_","textColor_","anchor_","textSize_","backgroundPosition_","backgroundPosition","_typeof","txtColor","txtSize","o","result","hasOwnProperty","pngsList","mapDragging","fetchData","j","pngs","scrollElement","contentElement","markerPosition","latitude","longitude","randKey","img","imgSize","icon","user_id","full_name","avatar","warn","markerCluster","bindListeners","createMap","$wrapper","$map","opt","Map","root","noop","bind","fn","thisArg","arguments","Promise","TypeError","_state","_handled","_value","_deferreds","handle","deferred","_immediateFn","cb","onFulfilled","onRejected","resolve","reject","promise","ret","e","newValue","then","finale","_unhandledRejectionFn","Handler","doResolve","done","reason","ex","setTimeoutFunc","prom","constructor","args","Array","res","val","remaining","race","values","setImmediate","console","_setImmediateFn","_setUnhandledRejectionFn","module","exports","normalizeName","String","test","normalizeValue","iteratorFor","items","iterator","support","iterable","Headers","headers","header","getOwnPropertyNames","consumed","body","bodyUsed","fileReaderReady","reader","onload","onerror","readBlobAsArrayBuffer","blob","FileReader","readAsArrayBuffer","readBlobAsText","readAsText","readArrayBufferAsText","buf","view","Uint8Array","chars","fromCharCode","bufferClone","byteLength","set","buffer","Body","_initBody","_bodyInit","_bodyText","Blob","isPrototypeOf","_bodyBlob","formData","FormData","_bodyFormData","searchParams","URLSearchParams","arrayBuffer","isDataView","_bodyArrayBuffer","ArrayBuffer","isArrayBufferView","rejected","decode","json","JSON","parse","normalizeMethod","method","upcased","toUpperCase","methods","Request","credentials","mode","referrer","form","trim","split","bytes","decodeURIComponent","parseHeaders","rawHeaders","line","parts","key","Response","bodyInit","status","ok","statusText","fetch","viewClasses","obj","DataView","isView","oldValue","has","callback","entries","clone","response","redirectStatuses","redirect","RangeError","init","request","xhr","XMLHttpRequest","getAllResponseHeaders","responseURL","responseText","ontimeout","withCredentials","responseType","setRequestHeader","send","polyfill","placeCharacters","checkAssetsPath","RegExp","settings","listeners","wrapper","avatarURL","defineURL","initFetchData","initSearchBox","initPromoAreas","initMapFullDisplay","initMapGenericBehaviour","isLoggedIn","_this","public","_this2","imgURL","clickEvent","initialize","onPlotLocation","airBalloon","logged","balloon","dismiss","attr","onAirBalloonClick","Image","imgWidth","abs","imgHeight","src","panelClosedOnLoad","toggleClass","changeMapLocation","panTo","onMapReady","onMapChangeLocation","imgFormat","showMap","showMapButton","topLeft","bottomRight","onClick","bindEvents","$panel","hasClass","setOptions","setWidthHeight","onClickUser","bindClickEvent","geolocationAPI","geolocation","getCurrentPosition","position","initialLocation","coords","enablePlotLocationMode"],"mappings":"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"}